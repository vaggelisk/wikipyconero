{"remainingRequest":"/home/kantro/WebstormProjects/wikipyconero/node_modules/babel-loader/lib/index.js??ref--0-1!/home/kantro/WebstormProjects/wikipyconero/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/kantro/WebstormProjects/wikipyconero/client/components/editor/editor-markdown.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/kantro/WebstormProjects/wikipyconero/client/components/editor/editor-markdown.vue","mtime":1715604756152},{"path":"/home/kantro/WebstormProjects/wikipyconero/.babelrc","mtime":1695287603859},{"path":"/home/kantro/WebstormProjects/wikipyconero/node_modules/cache-loader/dist/cjs.js","mtime":1694896091905},{"path":"/home/kantro/WebstormProjects/wikipyconero/node_modules/babel-loader/lib/index.js","mtime":1694896091857},{"path":"/home/kantro/WebstormProjects/wikipyconero/node_modules/vue-loader/lib/index.js","mtime":1695231282570}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zZXQgZnJvbSAibG9kYXNoL3NldCI7CmltcG9ydCBfZmluZExhc3QgZnJvbSAibG9kYXNoL2ZpbmRMYXN0IjsKaW1wb3J0IF9sYXN0IGZyb20gImxvZGFzaC9sYXN0IjsKaW1wb3J0IF9mbGF0dGVuIGZyb20gImxvZGFzaC9mbGF0dGVuIjsKaW1wb3J0IF9nZXQgZnJvbSAibG9kYXNoL2dldCI7CmltcG9ydCBfdGltZXMgZnJvbSAibG9kYXNoL3RpbWVzIjsKaW1wb3J0IF9zdGFydHNXaXRoIGZyb20gImxvZGFzaC9zdGFydHNXaXRoIjsKaW1wb3J0IF9kZWJvdW5jZSBmcm9tICJsb2Rhc2gvZGVib3VuY2UiOwppbXBvcnQgX2VzY2FwZSBmcm9tICJsb2Rhc2gvZXNjYXBlIjsgLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgZ2V0LCBzeW5jIH0gZnJvbSAndnVleC1wYXRoaWZ5JzsKaW1wb3J0IG1hcmtkb3duSGVscCBmcm9tICcuL21hcmtkb3duL2hlbHAudnVlJzsKaW1wb3J0IERPTVB1cmlmeSBmcm9tICdkb21wdXJpZnknOwoKLyogZ2xvYmFsIHNpdGVDb25maWcsIHNpdGVMYW5ncyAqLwoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBJTVBPUlRTCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCi8vIENvZGUgTWlycm9yCmltcG9ydCBDb2RlTWlycm9yIGZyb20gJ2NvZGVtaXJyb3InOwppbXBvcnQgJ2NvZGVtaXJyb3IvbGliL2NvZGVtaXJyb3IuY3NzJzsKCi8vIExhbmd1YWdlCmltcG9ydCAnY29kZW1pcnJvci9tb2RlL21hcmtkb3duL21hcmtkb3duLmpzJzsKCi8vIEFkZG9ucwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vc2VsZWN0aW9uL2FjdGl2ZS1saW5lLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2Rpc3BsYXkvZnVsbHNjcmVlbi5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9kaXNwbGF5L2Z1bGxzY3JlZW4uY3NzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL3NlbGVjdGlvbi9tYXJrLXNlbGVjdGlvbi5qcyc7CmltcG9ydCAnY29kZW1pcnJvci9hZGRvbi9zZWFyY2gvc2VhcmNoY3Vyc29yLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2hpbnQvc2hvdy1oaW50LmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2ZvbGQvZm9sZGNvZGUuanMnOwppbXBvcnQgJ2NvZGVtaXJyb3IvYWRkb24vZm9sZC9mb2xkZ3V0dGVyLmpzJzsKaW1wb3J0ICdjb2RlbWlycm9yL2FkZG9uL2ZvbGQvZm9sZGd1dHRlci5jc3MnOwoKLy8gTWFya2Rvd24taXQKaW1wb3J0IE1hcmtkb3duSXQgZnJvbSAnbWFya2Rvd24taXQnOwppbXBvcnQgbWRBdHRycyBmcm9tICdtYXJrZG93bi1pdC1hdHRycyc7CmltcG9ydCBtZERlY29yYXRlIGZyb20gJ21hcmtkb3duLWl0LWRlY29yYXRlJzsKaW1wb3J0IG1kRW1vamkgZnJvbSAnbWFya2Rvd24taXQtZW1vamknOwppbXBvcnQgbWRUYXNrTGlzdHMgZnJvbSAnbWFya2Rvd24taXQtdGFzay1saXN0cyc7CmltcG9ydCBtZEV4cGFuZFRhYnMgZnJvbSAnbWFya2Rvd24taXQtZXhwYW5kLXRhYnMnOwppbXBvcnQgbWRBYmJyIGZyb20gJ21hcmtkb3duLWl0LWFiYnInOwppbXBvcnQgbWRTdXAgZnJvbSAnbWFya2Rvd24taXQtc3VwJzsKaW1wb3J0IG1kU3ViIGZyb20gJ21hcmtkb3duLWl0LXN1Yic7CmltcG9ydCBtZE1hcmsgZnJvbSAnbWFya2Rvd24taXQtbWFyayc7CmltcG9ydCBtZE11bHRpVGFibGUgZnJvbSAnbWFya2Rvd24taXQtbXVsdGltZC10YWJsZSc7CmltcG9ydCBtZEZvb3Rub3RlIGZyb20gJ21hcmtkb3duLWl0LWZvb3Rub3RlJzsKaW1wb3J0IG1kSW1zaXplIGZyb20gJ21hcmtkb3duLWl0LWltc2l6ZSc7CmltcG9ydCBrYXRleCBmcm9tICdrYXRleCc7CmltcG9ydCB1bmRlcmxpbmUgZnJvbSAnLi4vLi4vbGlicy9tYXJrZG93bi1pdC11bmRlcmxpbmUnOwppbXBvcnQgJ2thdGV4L2Rpc3QvY29udHJpYi9taGNoZW0nOwppbXBvcnQgdHdlbW9qaSBmcm9tICd0d2Vtb2ppJzsKaW1wb3J0IHBsYW50dW1sIGZyb20gJy4vbWFya2Rvd24vcGxhbnR1bWwnOwoKLy8gUHJpc20gKFN5bnRheCBIaWdobGlnaHRpbmcpCmltcG9ydCBQcmlzbSBmcm9tICJwcmlzbWpzL2NvbXBvbmVudHMvcHJpc20tY29yZSI7IC8vIE1lcm1haWQKaW1wb3J0ICJwcmlzbWpzL2NvbXBvbmVudHMvcHJpc20tY2xpa2UiOwppbXBvcnQgInByaXNtanMvY29tcG9uZW50cy9wcmlzbS1tYXJrdXAiOwppbXBvcnQgInByaXNtanMvcGx1Z2lucy9saW5lLW51bWJlcnMvcHJpc20tbGluZS1udW1iZXJzLmNzcyI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL2xpbmUtbnVtYmVycy9wcmlzbS1saW5lLW51bWJlcnMiOwppbXBvcnQgInByaXNtanMvcGx1Z2lucy9hdXRvbG9hZGVyL3ByaXNtLWF1dG9sb2FkZXIiOwppbXBvcnQgInByaXNtanMvcGx1Z2lucy9ub3JtYWxpemUtd2hpdGVzcGFjZS9wcmlzbS1ub3JtYWxpemUtd2hpdGVzcGFjZSI7CmltcG9ydCAicHJpc21qcy9wbHVnaW5zL3Rvb2xiYXIvcHJpc20tdG9vbGJhci5jc3MiOwppbXBvcnQgInByaXNtanMvcGx1Z2lucy90b29sYmFyL3ByaXNtLXRvb2xiYXIiOwppbXBvcnQgInByaXNtanMvcGx1Z2lucy9jb3B5LXRvLWNsaXBib2FyZC9wcmlzbS1jb3B5LXRvLWNsaXBib2FyZCI7CmltcG9ydCAicHJpc21qcy90aGVtZXMvcHJpc20tdHdpbGlnaHQuY3NzIjsKaW1wb3J0IG1lcm1haWQgZnJvbSAnbWVybWFpZCc7CgovLyBIZWxwZXJzCmltcG9ydCBrYXRleEhlbHBlciBmcm9tICcuL2NvbW1vbi9rYXRleCc7CmltcG9ydCB0YWJzZXRIZWxwZXIgZnJvbSAnLi9tYXJrZG93bi90YWJzZXQnOwppbXBvcnQgY21Gb2xkIGZyb20gJy4vY29tbW9uL2NtRm9sZCc7CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIElOSVQKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKLy8gUGxhdGZvcm0gZGV0ZWN0aW9uCmNvbnN0IEN0cmxLZXkgPSAvTWFjLy50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSkgPyAnQ21kJyA6ICdDdHJsJzsKCi8vIFByaXNtIENvbmZpZwpQcmlzbS5wbHVnaW5zLmF1dG9sb2FkZXIubGFuZ3VhZ2VzX3BhdGggPSAnL19hc3NldHMvanMvcHJpc20vJzsKUHJpc20ucGx1Z2lucy5Ob3JtYWxpemVXaGl0ZXNwYWNlLnNldERlZmF1bHRzKHsKICAncmVtb3ZlLXRyYWlsaW5nJzogdHJ1ZSwKICAncmVtb3ZlLWluZGVudCc6IHRydWUsCiAgJ2xlZnQtdHJpbSc6IHRydWUsCiAgJ3JpZ2h0LXRyaW0nOiB0cnVlLAogICdyZW1vdmUtaW5pdGlhbC1saW5lLWZlZWQnOiB0cnVlLAogICd0YWJzLXRvLXNwYWNlcyc6IDIKfSk7CgovLyBNYXJrZG93biBJbnN0YW5jZQpjb25zdCBtZCA9IG5ldyBNYXJrZG93bkl0KHsKICBodG1sOiB0cnVlLAogIGJyZWFrczogdHJ1ZSwKICBsaW5raWZ5OiB0cnVlLAogIHR5cG9ncmFwaHk6IHRydWUsCiAgaGlnaGxpZ2h0KHN0ciwgbGFuZykgewogICAgaWYgKGxhbmcgPT09ICdkaWFncmFtJykgewogICAgICByZXR1cm4gYDxwcmUgY2xhc3M9ImRpYWdyYW0iPmAgKyBCdWZmZXIuZnJvbShzdHIsICdiYXNlNjQnKS50b1N0cmluZygpICsgYDwvcHJlPmA7CiAgICB9IGVsc2UgaWYgKFsnbWVybWFpZCcsICdwbGFudHVtbCddLmluY2x1ZGVzKGxhbmcpKSB7CiAgICAgIHJldHVybiBgPHByZSBjbGFzcz0iY29kZWJsb2NrLSR7bGFuZ30iPjxjb2RlPiR7X2VzY2FwZShzdHIpfTwvY29kZT48L3ByZT5gOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGA8cHJlIGNsYXNzPSJsaW5lLW51bWJlcnMiPjxjb2RlIGNsYXNzPSJsYW5ndWFnZS0ke2xhbmd9Ij4ke19lc2NhcGUoc3RyKX08L2NvZGU+PC9wcmU+YDsKICAgIH0KICB9Cn0pLnVzZShtZEF0dHJzLCB7CiAgYWxsb3dlZEF0dHJpYnV0ZXM6IFsnaWQnLCAnY2xhc3MnLCAndGFyZ2V0J10KfSkudXNlKG1kRGVjb3JhdGUpLnVzZSh1bmRlcmxpbmUpLnVzZShtZEVtb2ppKS51c2UobWRUYXNrTGlzdHMsIHsKICBsYWJlbDogZmFsc2UsCiAgbGFiZWxBZnRlcjogZmFsc2UKfSkudXNlKG1kRXhwYW5kVGFicykudXNlKG1kQWJicikudXNlKG1kU3VwKS51c2UobWRTdWIpLnVzZShtZE11bHRpVGFibGUsIHsKICBtdWx0aWxpbmU6IHRydWUsCiAgcm93c3BhbjogdHJ1ZSwKICBoZWFkZXJsZXNzOiB0cnVlCn0pLnVzZShtZE1hcmspLnVzZShtZEZvb3Rub3RlKS51c2UobWRJbXNpemUpOwoKLy8gRE9NUHVyaWZ5IGZpeCBmb3IgZHJhdy5pbwpET01QdXJpZnkuYWRkSG9vaygndXBvblNhbml0aXplRWxlbWVudCcsIGVsbSA9PiB7CiAgaWYgKGVsbS5xdWVyeVNlbGVjdG9yQWxsKSB7CiAgICBjb25zdCBicmVha3MgPSBlbG0ucXVlcnlTZWxlY3RvckFsbCgnZm9yZWlnbk9iamVjdCBiciwgZm9yZWlnbk9iamVjdCBwJyk7CiAgICBpZiAoYnJlYWtzICYmIGJyZWFrcy5sZW5ndGgpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBicmVha3MubGVuZ3RoOyBpKyspIHsKICAgICAgICBicmVha3NbaV0ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksIGJyZWFrc1tpXSk7CiAgICAgIH0KICAgIH0KICB9Cn0pOwoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBIRUxQRVIgRlVOQ1RJT05TCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCi8vIEluamVjdCBsaW5lIG51bWJlcnMgZm9yIHByZXZpZXcgc2Nyb2xsIHN5bmMKbGV0IGxpbmVzTWFwID0gW107CmZ1bmN0aW9uIGluamVjdExpbmVOdW1iZXJzKHRva2VucywgaWR4LCBvcHRpb25zLCBlbnYsIHNsZikgewogIGxldCBsaW5lOwogIGlmICh0b2tlbnNbaWR4XS5tYXAgJiYgdG9rZW5zW2lkeF0ubGV2ZWwgPT09IDApIHsKICAgIGxpbmUgPSB0b2tlbnNbaWR4XS5tYXBbMF07CiAgICB0b2tlbnNbaWR4XS5hdHRySm9pbignY2xhc3MnLCAnbGluZScpOwogICAgdG9rZW5zW2lkeF0uYXR0clNldCgnZGF0YS1saW5lJywgU3RyaW5nKGxpbmUpKTsKICAgIGxpbmVzTWFwLnB1c2gobGluZSk7CiAgfQogIHJldHVybiBzbGYucmVuZGVyVG9rZW4odG9rZW5zLCBpZHgsIG9wdGlvbnMsIGVudiwgc2xmKTsKfQptZC5yZW5kZXJlci5ydWxlcy5wYXJhZ3JhcGhfb3BlbiA9IGluamVjdExpbmVOdW1iZXJzOwptZC5yZW5kZXJlci5ydWxlcy5oZWFkaW5nX29wZW4gPSBpbmplY3RMaW5lTnVtYmVyczsKbWQucmVuZGVyZXIucnVsZXMuYmxvY2txdW90ZV9vcGVuID0gaW5qZWN0TGluZU51bWJlcnM7CmNtRm9sZC5yZWdpc3RlcignbWFya2Rvd24nKTsKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBQTEFOVFVNTAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgovLyBUT0RPOiBVc2Ugc2FtZSBvcHRpb25zIGFzIGRlZmluZWQgaW4gYmFja2VuZApwbGFudHVtbC5pbml0KG1kLCB7fSk7CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEtBVEVYCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNvbnN0IG1hY3JvcyA9IHt9OwptZC5pbmxpbmUucnVsZXIuYWZ0ZXIoJ2VzY2FwZScsICdrYXRleF9pbmxpbmUnLCBrYXRleEhlbHBlci5rYXRleElubGluZSk7Cm1kLnJlbmRlcmVyLnJ1bGVzLmthdGV4X2lubGluZSA9ICh0b2tlbnMsIGlkeCkgPT4gewogIHRyeSB7CiAgICByZXR1cm4ga2F0ZXgucmVuZGVyVG9TdHJpbmcodG9rZW5zW2lkeF0uY29udGVudCwgewogICAgICBkaXNwbGF5TW9kZTogZmFsc2UsCiAgICAgIG1hY3JvcwogICAgfSk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsKbWQuYmxvY2sucnVsZXIuYWZ0ZXIoJ2Jsb2NrcXVvdGUnLCAna2F0ZXhfYmxvY2snLCBrYXRleEhlbHBlci5rYXRleEJsb2NrLCB7CiAgYWx0OiBbJ3BhcmFncmFwaCcsICdyZWZlcmVuY2UnLCAnYmxvY2txdW90ZScsICdsaXN0J10KfSk7Cm1kLnJlbmRlcmVyLnJ1bGVzLmthdGV4X2Jsb2NrID0gKHRva2VucywgaWR4KSA9PiB7CiAgdHJ5IHsKICAgIHJldHVybiBgPHA+YCArIGthdGV4LnJlbmRlclRvU3RyaW5nKHRva2Vuc1tpZHhdLmNvbnRlbnQsIHsKICAgICAgZGlzcGxheU1vZGU6IHRydWUsCiAgICAgIG1hY3JvcwogICAgfSkgKyBgPC9wPmA7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgIHJldHVybiB0b2tlbnNbaWR4XS5jb250ZW50OwogIH0KfTsKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gVFdFTU9KSQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgptZC5yZW5kZXJlci5ydWxlcy5lbW9qaSA9ICh0b2tlbiwgaWR4KSA9PiB7CiAgcmV0dXJuIHR3ZW1vamkucGFyc2UodG9rZW5baWR4XS5jb250ZW50LCB7CiAgICBjYWxsYmFjayhpY29uLCBvcHRzKSB7CiAgICAgIHJldHVybiBgL19hc3NldHMvc3ZnL3R3ZW1vamkvJHtpY29ufS5zdmdgOwogICAgfQogIH0pOwp9OwoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBWdWUgQ29tcG9uZW50Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmxldCBtZXJtYWlkSWQgPSAwOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgbWFya2Rvd25IZWxwCiAgfSwKICBwcm9wczogewogICAgc2F2ZTogewogICAgICB0eXBlOiBGdW5jdGlvbiwKICAgICAgZGVmYXVsdDogKCkgPT4ge30KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBmYWJJbnNlcnRNZW51OiBmYWxzZSwKICAgICAgY206IG51bGwsCiAgICAgIGN1cnNvclBvczogewogICAgICAgIGNoOiAwLAogICAgICAgIGxpbmU6IDEKICAgICAgfSwKICAgICAgcHJldmlld1Nob3duOiB0cnVlLAogICAgICBwcmV2aWV3SFRNTDogJycsCiAgICAgIGhlbHBTaG93bjogZmFsc2UsCiAgICAgIHNwZWxsTW9kZUFjdGl2ZTogZmFsc2UsCiAgICAgIGluc2VydExpbmtEaWFsb2c6IGZhbHNlCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGlzTW9iaWxlKCkgewogICAgICByZXR1cm4gdGhpcy4kdnVldGlmeS5icmVha3BvaW50LnNtQW5kRG93bjsKICAgIH0sCiAgICBpc01vZGFsU2hvd24oKSB7CiAgICAgIHJldHVybiB0aGlzLmhlbHBTaG93biB8fCB0aGlzLmFjdGl2ZU1vZGFsICE9PSAnJzsKICAgIH0sCiAgICBsb2NhbGU6IGdldCgncGFnZS9sb2NhbGUnKSwKICAgIHBhdGg6IGdldCgncGFnZS9wYXRoJyksCiAgICBtb2RlOiBnZXQoJ2VkaXRvci9tb2RlJyksCiAgICBhY3RpdmVNb2RhbDogc3luYygnZWRpdG9yL2FjdGl2ZU1vZGFsJykKICB9LAogIHdhdGNoOiB7CiAgICBwcmV2aWV3U2hvd24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICAgIGlmIChuZXdWYWx1ZSAmJiAhb2xkVmFsdWUpIHsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLnJlbmRlck1lcm1haWREaWFncmFtcygpOwogICAgICAgICAgUHJpc20uaGlnaGxpZ2h0QWxsVW5kZXIodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3KTsKICAgICAgICAgIEFycmF5LmZyb20odGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZS5saW5lLW51bWJlcnMnKSkuZm9yRWFjaChwcmUgPT4gcHJlLmNsYXNzTGlzdC5hZGQoJ3ByaXNtanMnKSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzcGVsbE1vZGVBY3RpdmUobmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICAgIGlmIChuZXdWYWx1ZSkgewogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5mb2N1cygpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICB0b2dnbGVNb2RhbChrZXkpIHsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9IHRoaXMuYWN0aXZlTW9kYWwgPT09IGtleSA/ICcnIDoga2V5OwogICAgICB0aGlzLmhlbHBTaG93biA9IGZhbHNlOwogICAgfSwKICAgIGNsb3NlQWxsTW9kYWwoKSB7CiAgICAgIHRoaXMuYWN0aXZlTW9kYWwgPSAnJzsKICAgICAgdGhpcy5oZWxwU2hvd24gPSBmYWxzZTsKICAgIH0sCiAgICBvbkNtSW5wdXQ6IF9kZWJvdW5jZShmdW5jdGlvbiAobmV3Q29udGVudCkgewogICAgICB0aGlzLnByb2Nlc3NDb250ZW50KG5ld0NvbnRlbnQpOwogICAgfSwgNjAwKSwKICAgIG9uQ21QYXN0ZShjbSwgZXYpIHsKICAgICAgLy8gY29uc3QgY2xpcEl0ZW1zID0gKGV2LmNsaXBib2FyZERhdGEgfHwgZXYub3JpZ2luYWxFdmVudC5jbGlwYm9hcmREYXRhKS5pdGVtcwogICAgICAvLyBmb3IgKGxldCBjbGlwSXRlbSBvZiBjbGlwSXRlbXMpIHsKICAgICAgLy8gICBpZiAoXy5zdGFydHNXaXRoKGNsaXBJdGVtLnR5cGUsICdpbWFnZS8nKSkgewogICAgICAvLyAgICAgY29uc3QgZmlsZSA9IGNsaXBJdGVtLmdldEFzRmlsZSgpCiAgICAgIC8vICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpCiAgICAgIC8vICAgICByZWFkZXIub25sb2FkID0gZXZ0ID0+IHsKICAgICAgLy8gICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KGBsb2FkaW5nU3RhcnRgLCAnZWRpdG9yLXBhc3RlLWltYWdlJykKICAgICAgLy8gICAgICAgdGhpcy5pbnNlcnRBZnRlcih7CiAgICAgIC8vICAgICAgICAgY29udGVudDogYCFbJHtmaWxlLm5hbWV9XSgke2V2dC50YXJnZXQucmVzdWx0fSlgLAogICAgICAvLyAgICAgICAgIG5ld0xpbmU6IHRydWUKICAgICAgLy8gICAgICAgfSkKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpCiAgICAgIC8vICAgfQogICAgICAvLyB9CiAgICB9LAogICAgcHJvY2Vzc0NvbnRlbnQobmV3Q29udGVudCkgewogICAgICBsaW5lc01hcCA9IFtdOwogICAgICAvLyB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9jb250ZW50JywgbmV3Q29udGVudCkKICAgICAgdGhpcy5wcm9jZXNzTWFya2Vycyh0aGlzLmNtLmZpcnN0TGluZSgpLCB0aGlzLmNtLmxhc3RMaW5lKCkpOwogICAgICB0aGlzLnByZXZpZXdIVE1MID0gRE9NUHVyaWZ5LnNhbml0aXplKG1kLnJlbmRlcihuZXdDb250ZW50KSwgewogICAgICAgIEFERF9UQUdTOiBbJ2ZvcmVpZ25PYmplY3QnXQogICAgICB9KTsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIHRhYnNldEhlbHBlci5mb3JtYXQoKTsKICAgICAgICB0aGlzLnJlbmRlck1lcm1haWREaWFncmFtcygpOwogICAgICAgIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyKHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldyk7CiAgICAgICAgQXJyYXkuZnJvbSh0aGlzLiRyZWZzLmVkaXRvclByZXZpZXcucXVlcnlTZWxlY3RvckFsbCgncHJlLmxpbmUtbnVtYmVycycpKS5mb3JFYWNoKHByZSA9PiBwcmUuY2xhc3NMaXN0LmFkZCgncHJpc21qcycpKTsKICAgICAgICB0aGlzLnNjcm9sbFN5bmModGhpcy5jbSk7CiAgICAgIH0pOwogICAgfSwKICAgIC8qKgogICAgICogVXBkYXRlIGN1cnNvciBzdGF0ZQogICAgICovCiAgICBwb3NpdGlvblN5bmMoY20pIHsKICAgICAgdGhpcy5jdXJzb3JQb3MgPSBjbS5nZXRDdXJzb3IoJ2hlYWQnKTsKICAgIH0sCiAgICAvKioKICAgICAqIFdyYXAgc2VsZWN0aW9uIHdpdGggc3RhcnQgLyBlbmQgdGFncwogICAgICovCiAgICB0b2dnbGVNYXJrdXAoX3JlZikgewogICAgICBsZXQgewogICAgICAgIHN0YXJ0LAogICAgICAgIGVuZAogICAgICB9ID0gX3JlZjsKICAgICAgaWYgKCFlbmQpIHsKICAgICAgICBlbmQgPSBzdGFydDsKICAgICAgfQogICAgICBpZiAoIXRoaXMuY20uZG9jLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgnZWRpdG9yOm1hcmt1cC5ub1NlbGVjdGlvbkVycm9yJyksCiAgICAgICAgICBzdHlsZTogJ3dhcm5pbmcnLAogICAgICAgICAgaWNvbjogJ3dhcm5pbmcnCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVNlbGVjdGlvbnModGhpcy5jbS5kb2MuZ2V0U2VsZWN0aW9ucygpLm1hcChzID0+IHN0YXJ0ICsgcyArIGVuZCkpOwogICAgfSwKICAgIC8qKgogICAgICogU2V0IGN1cnJlbnQgbGluZSBhcyBoZWFkZXIKICAgICAqLwogICAgc2V0SGVhZGVyTGluZShsdmwpIHsKICAgICAgY29uc3QgY3VyTGluZSA9IHRoaXMuY20uZG9jLmdldEN1cnNvcignaGVhZCcpLmxpbmU7CiAgICAgIGxldCBsaW5lQ29udGVudCA9IHRoaXMuY20uZG9jLmdldExpbmUoY3VyTGluZSk7CiAgICAgIGNvbnN0IGxpbmVMZW5ndGggPSBsaW5lQ29udGVudC5sZW5ndGg7CiAgICAgIGlmIChfc3RhcnRzV2l0aChsaW5lQ29udGVudCwgJyMnKSkgewogICAgICAgIGxpbmVDb250ZW50ID0gbGluZUNvbnRlbnQucmVwbGFjZSgvXigjKyApLywgJycpOwogICAgICB9CiAgICAgIGxpbmVDb250ZW50ID0gX3RpbWVzKGx2bCwgbiA9PiAnIycpLmpvaW4oJycpICsgYCBgICsgbGluZUNvbnRlbnQ7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShsaW5lQ29udGVudCwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IDAKICAgICAgfSwgewogICAgICAgIGxpbmU6IGN1ckxpbmUsCiAgICAgICAgY2g6IGxpbmVMZW5ndGgKICAgICAgfSk7CiAgICB9LAogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlYWRlciBsZXZlciBvZiB0aGUgY3VycmVudCBsaW5lCiAgICAgKi8KICAgIGdldEhlYWRlckxldmVsKGNtKSB7CiAgICAgIGNvbnN0IGN1ckxpbmUgPSB0aGlzLmNtLmRvYy5nZXRDdXJzb3IoJ2hlYWQnKS5saW5lOwogICAgICBsZXQgbGluZUNvbnRlbnQgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGN1ckxpbmUpOwogICAgICBsZXQgbHZsID0gMDsKICAgICAgY29uc3QgcmVzdWx0ID0gbGluZUNvbnRlbnQubWF0Y2goL14oIyspIC8pOwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgbHZsID0gX2dldChyZXN1bHQsICdbMV0nLCAnJykubGVuZ3RoOwogICAgICB9CiAgICAgIHJldHVybiBsdmw7CiAgICB9LAogICAgLyoqCiAgICAgKiBJbnNlcnQgY29udGVudCBhdCBjdXJzb3IKICAgICAqLwogICAgaW5zZXJ0QXRDdXJzb3IoX3JlZjIpIHsKICAgICAgbGV0IHsKICAgICAgICBjb250ZW50CiAgICAgIH0gPSBfcmVmMjsKICAgICAgY29uc3QgY3Vyc29yID0gdGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJyk7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShjb250ZW50LCBjdXJzb3IpOwogICAgfSwKICAgIC8qKgogICAgICogSW5zZXJ0IGNvbnRlbnQgYWZ0ZXIgY3VycmVudCBsaW5lCiAgICAgKi8KICAgIGluc2VydEFmdGVyKF9yZWYzKSB7CiAgICAgIGxldCB7CiAgICAgICAgY29udGVudCwKICAgICAgICBuZXdMaW5lCiAgICAgIH0gPSBfcmVmMzsKICAgICAgY29uc3QgY3VyTGluZSA9IHRoaXMuY20uZG9jLmdldEN1cnNvcigndG8nKS5saW5lOwogICAgICBjb25zdCBsaW5lTGVuZ3RoID0gdGhpcy5jbS5kb2MuZ2V0TGluZShjdXJMaW5lKS5sZW5ndGg7CiAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShuZXdMaW5lID8gYFxuJHtjb250ZW50fVxuYCA6IGNvbnRlbnQsIHsKICAgICAgICBsaW5lOiBjdXJMaW5lLAogICAgICAgIGNoOiBsaW5lTGVuZ3RoICsgMQogICAgICB9KTsKICAgIH0sCiAgICAvKioKICAgICAqIEluc2VydCBjb250ZW50IGJlZm9yZSBjdXJyZW50IGxpbmUKICAgICAqLwogICAgaW5zZXJ0QmVmb3JlRWFjaExpbmUoX3JlZjQpIHsKICAgICAgbGV0IHsKICAgICAgICBjb250ZW50LAogICAgICAgIGFmdGVyCiAgICAgIH0gPSBfcmVmNDsKICAgICAgbGV0IGxpbmVzID0gW107CiAgICAgIGlmICghdGhpcy5jbS5kb2Muc29tZXRoaW5nU2VsZWN0ZWQoKSkgewogICAgICAgIGxpbmVzLnB1c2godGhpcy5jbS5kb2MuZ2V0Q3Vyc29yKCdoZWFkJykubGluZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGluZXMgPSBfZmxhdHRlbih0aGlzLmNtLmRvYy5saXN0U2VsZWN0aW9ucygpLm1hcChzbCA9PiB7CiAgICAgICAgICBjb25zdCByYW5nZSA9IE1hdGguYWJzKHNsLmFuY2hvci5saW5lIC0gc2wuaGVhZC5saW5lKSArIDE7CiAgICAgICAgICBjb25zdCBsb3dlc3RMaW5lID0gc2wuYW5jaG9yLmxpbmUgPiBzbC5oZWFkLmxpbmUgPyBzbC5oZWFkLmxpbmUgOiBzbC5hbmNob3IubGluZTsKICAgICAgICAgIHJldHVybiBfdGltZXMocmFuZ2UsIGwgPT4gbCArIGxvd2VzdExpbmUpOwogICAgICAgIH0pKTsKICAgICAgfQogICAgICBsaW5lcy5mb3JFYWNoKGxuID0+IHsKICAgICAgICBsZXQgbGluZUNvbnRlbnQgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGxuKTsKICAgICAgICBjb25zdCBsaW5lTGVuZ3RoID0gbGluZUNvbnRlbnQubGVuZ3RoOwogICAgICAgIGlmIChfc3RhcnRzV2l0aChsaW5lQ29udGVudCwgY29udGVudCkpIHsKICAgICAgICAgIGxpbmVDb250ZW50ID0gbGluZUNvbnRlbnQuc3Vic3RyaW5nKGNvbnRlbnQubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVJhbmdlKGNvbnRlbnQgKyBsaW5lQ29udGVudCwgewogICAgICAgICAgbGluZTogbG4sCiAgICAgICAgICBjaDogMAogICAgICAgIH0sIHsKICAgICAgICAgIGxpbmU6IGxuLAogICAgICAgICAgY2g6IGxpbmVMZW5ndGgKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIGlmIChhZnRlcikgewogICAgICAgIGNvbnN0IGxhc3RMaW5lID0gX2xhc3QobGluZXMpOwogICAgICAgIHRoaXMuY20uZG9jLnJlcGxhY2VSYW5nZShgXG4ke2FmdGVyfVxuYCwgewogICAgICAgICAgbGluZTogbGFzdExpbmUsCiAgICAgICAgICBjaDogdGhpcy5jbS5kb2MuZ2V0TGluZShsYXN0TGluZSkubGVuZ3RoICsgMQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLyoqCiAgICAgKiBVcGRhdGUgc2Nyb2xsIHN5bmMKICAgICAqLwogICAgc2Nyb2xsU3luYzogX2RlYm91bmNlKGZ1bmN0aW9uIChjbSkgewogICAgICBpZiAoIXRoaXMucHJldmlld1Nob3duIHx8IGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGV0IGN1cnJlbnRMaW5lID0gY20uZ2V0Q3Vyc29yKCkubGluZTsKICAgICAgaWYgKGN1cnJlbnRMaW5lIDwgMykgewogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LCAnc3RvcCcsIHRydWUpOwogICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LmZpcnN0Q2hpbGQsICdzY3JvbGwnLCB7CiAgICAgICAgICBvZmZzZXQ6ICctNTAnLAogICAgICAgICAgZHVyYXRpb246IDEwMDAsCiAgICAgICAgICBjb250YWluZXI6IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlld0NvbnRhaW5lcgogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBjbG9zZXN0TGluZSA9IF9maW5kTGFzdChsaW5lc01hcCwgbiA9PiBuIDw9IGN1cnJlbnRMaW5lKTsKICAgICAgICBsZXQgZGVzdEVsbSA9IHRoaXMuJHJlZnMuZWRpdG9yUHJldmlldy5xdWVyeVNlbGVjdG9yKGBbZGF0YS1saW5lPScke2Nsb3Nlc3RMaW5lfSddYCk7CiAgICAgICAgaWYgKGRlc3RFbG0pIHsKICAgICAgICAgIHRoaXMuVmVsb2NpdHkodGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3LCAnc3RvcCcsIHRydWUpOwogICAgICAgICAgdGhpcy5WZWxvY2l0eShkZXN0RWxtLCAnc2Nyb2xsJywgewogICAgICAgICAgICBvZmZzZXQ6ICctMTAwJywKICAgICAgICAgICAgZHVyYXRpb246IDEwMDAsCiAgICAgICAgICAgIGNvbnRhaW5lcjogdGhpcy4kcmVmcy5lZGl0b3JQcmV2aWV3Q29udGFpbmVyCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIDUwMCksCiAgICB0b2dnbGVIZWxwKCkgewogICAgICB0aGlzLmhlbHBTaG93biA9ICF0aGlzLmhlbHBTaG93bjsKICAgICAgdGhpcy5hY3RpdmVNb2RhbCA9ICcnOwogICAgfSwKICAgIHRvZ2dsZUZ1bGxzY3JlZW4oKSB7CiAgICAgIHRoaXMuY20uc2V0T3B0aW9uKCdmdWxsU2NyZWVuJywgdHJ1ZSk7CiAgICB9LAogICAgcmVmcmVzaCgpIHsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIHRoaXMuY20ucmVmcmVzaCgpOwogICAgICB9KTsKICAgIH0sCiAgICByZW5kZXJNZXJtYWlkRGlhZ3JhbXMoKSB7CiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lZGl0b3ItbWFya2Rvd24tcHJldmlldyBwcmUuY29kZWJsb2NrLW1lcm1haWQgPiBjb2RlJykuZm9yRWFjaChlbG0gPT4gewogICAgICAgIG1lcm1haWRJZCsrOwogICAgICAgIGNvbnN0IG1lcm1haWREZWYgPSBlbG0uaW5uZXJUZXh0OwogICAgICAgIGNvbnN0IG1tRWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgbW1FbG0uaW5uZXJIVE1MID0gYDxkaXYgaWQ9Im1lcm1haWQtaWQtJHttZXJtYWlkSWR9Ij4ke21lcm1haWQucmVuZGVyKGBtZXJtYWlkLWlkLSR7bWVybWFpZElkfWAsIG1lcm1haWREZWYpfTwvZGl2PmA7CiAgICAgICAgZWxtLnBhcmVudEVsZW1lbnQucmVwbGFjZVdpdGgobW1FbG0pOwogICAgICB9KTsKICAgIH0sCiAgICBhdXRvY29tcGxldGUoY20sIGNoYW5nZSkgewogICAgICBpZiAoY20uZ2V0TW9kZUF0KGNtLmdldEN1cnNvcigpKS5uYW1lICE9PSAnbWFya2Rvd24nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBMaW5rcwogICAgICBpZiAoY2hhbmdlLnRleHRbMF0gPT09ICcoJykgewogICAgICAgIGNvbnN0IGN1ckxpbmUgPSBjbS5nZXRMaW5lKGNoYW5nZS5mcm9tLmxpbmUpLnN1YnN0cmluZygwLCBjaGFuZ2UuZnJvbS5jaCk7CiAgICAgICAgaWYgKGN1ckxpbmVbY3VyTGluZS5sZW5ndGggLSAxXSA9PT0gJ10nKSB7CiAgICAgICAgICBjbS5zaG93SGludCh7CiAgICAgICAgICAgIGhpbnQ6IGFzeW5jIChjbSwgb3B0aW9ucykgPT4gewogICAgICAgICAgICAgIGNvbnN0IGN1ciA9IGNtLmdldEN1cnNvcigpOwogICAgICAgICAgICAgIGNvbnN0IGN1ckxpbmUgPSBjbS5nZXRMaW5lKGN1ci5saW5lKS5zdWJzdHJpbmcoMCwgY3VyLmNoKTsKICAgICAgICAgICAgICBjb25zdCBxdWVyeVN0cmluZyA9IGN1ckxpbmUuc3Vic3RyaW5nKGN1ckxpbmUubGFzdEluZGV4T2YoJ1snKSArIDEsIGN1ckxpbmUubGVuZ3RoIC0gMik7CiAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBjbS5nZXRUb2tlbkF0KGN1cik7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BSYXcgPSBhd2FpdCB0aGlzLiRhcG9sbG8ucXVlcnkoewogICAgICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgICAgICJraW5kIjogIkRvY3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAiZGVmaW5pdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiT3BlcmF0aW9uRGVmaW5pdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAib3BlcmF0aW9uIjogInF1ZXJ5IiwKICAgICAgICAgICAgICAgICAgICAgICJ2YXJpYWJsZURlZmluaXRpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTm9uTnVsbFR5cGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZWRUeXBlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIlN0cmluZyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiVmFyaWFibGVEZWZpbml0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgInZhcmlhYmxlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJ0eXBlIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWVkVHlwZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJTdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9XSwKICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJTZWxlY3Rpb25TZXQiLAogICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9ucyI6IFt7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicGFnZXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZWxlY3Rpb25zIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAic2VhcmNoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW3sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJBcmd1bWVudCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJxdWVyeSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInF1ZXJ5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkFyZ3VtZW50IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlZhcmlhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJOYW1lIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogImxvY2FsZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2VsZWN0aW9uU2V0IjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIlNlbGVjdGlvblNldCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAicmVzdWx0cyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGlyZWN0aXZlcyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvblNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiU2VsZWN0aW9uU2V0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNlbGVjdGlvbnMiOiBbewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInRpdGxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIkZpZWxkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJraW5kIjogIk5hbWUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogInBhdGgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYXJndW1lbnRzIjogW10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiRmllbGQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAibG9jYWxlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkaXJlY3RpdmVzIjogW10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAia2luZCI6ICJGaWVsZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImtpbmQiOiAiTmFtZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6ICJ0b3RhbEhpdHMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImFyZ3VtZW50cyI6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRpcmVjdGl2ZXMiOiBbXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgICAgICAgICJsb2MiOiB7CiAgICAgICAgICAgICAgICAgICAgICAic3RhcnQiOiAwLAogICAgICAgICAgICAgICAgICAgICAgImVuZCI6IDQ0OSwKICAgICAgICAgICAgICAgICAgICAgICJzb3VyY2UiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJib2R5IjogIlxuICAgICAgICAgICAgICAgICAgICBxdWVyeSAoJHF1ZXJ5OiBTdHJpbmchLCAkbG9jYWxlOiBTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlcyB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2gocXVlcnk6JHF1ZXJ5LCBsb2NhbGU6JGxvY2FsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEhpdHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICIsCiAgICAgICAgICAgICAgICAgICAgICAgICJuYW1lIjogIkdyYXBoUUwgcmVxdWVzdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJsb2NhdGlvbk9mZnNldCI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAibGluZSI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgImNvbHVtbiI6IDEKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5U3RyaW5nLAogICAgICAgICAgICAgICAgICAgIGxvY2FsZTogdGhpcy5sb2NhbGUKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZmV0Y2hQb2xpY3k6ICdjYWNoZS1maXJzdCcKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3QgcmVzcCA9IF9nZXQocmVzcFJhdywgJ2RhdGEucGFnZXMuc2VhcmNoJywge30pOwogICAgICAgICAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC50b3RhbEhpdHMgPiAwKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgbGlzdDogcmVzcC5yZXN1bHRzLm1hcChyID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnKCcgKyAoc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyBgLyR7ci5sb2NhbGV9LyR7ci5wYXRofWAgOiBgLyR7ci5wYXRofWApICsgJyknLAogICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVRleHQ6IHNpdGVMYW5ncy5sZW5ndGggPiAwID8gYC8ke3IubG9jYWxlfS8ke3IucGF0aH0gLSAke3IudGl0bGV9YCA6IGAvJHtyLnBhdGh9IC0gJHtyLnRpdGxlfWAKICAgICAgICAgICAgICAgICAgICB9KSksCiAgICAgICAgICAgICAgICAgICAgZnJvbTogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLnN0YXJ0KSwKICAgICAgICAgICAgICAgICAgICB0bzogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLmVuZCkKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHt9CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGxpc3Q6IFtdLAogICAgICAgICAgICAgICAgZnJvbTogQ29kZU1pcnJvci5Qb3MoY3VyLmxpbmUsIHRva2VuLnN0YXJ0KSwKICAgICAgICAgICAgICAgIHRvOiBDb2RlTWlycm9yLlBvcyhjdXIubGluZSwgdG9rZW4uZW5kKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGluc2VydExpbmsoKSB7CiAgICAgIHRoaXMuaW5zZXJ0TGlua0RpYWxvZyA9IHRydWU7CiAgICB9LAogICAgaW5zZXJ0TGlua0hhbmRsZXIoX3JlZjUpIHsKICAgICAgbGV0IHsKICAgICAgICBsb2NhbGUsCiAgICAgICAgcGF0aAogICAgICB9ID0gX3JlZjU7CiAgICAgIGNvbnN0IGxhc3RQYXJ0ID0gX2xhc3QocGF0aC5zcGxpdCgnLycpKTsKICAgICAgdGhpcy5pbnNlcnRBdEN1cnNvcih7CiAgICAgICAgY29udGVudDogc2l0ZUxhbmdzLmxlbmd0aCA+IDAgPyBgWyR7bGFzdFBhcnR9XSgvJHtsb2NhbGV9LyR7cGF0aH0pYCA6IGBbJHtsYXN0UGFydH1dKC8ke3BhdGh9KWAKICAgICAgfSk7CiAgICB9LAogICAgcHJvY2Vzc01hcmtlcnMoZnJvbSwgdG8pIHsKICAgICAgbGV0IGZvdW5kID0gbnVsbDsKICAgICAgbGV0IGZvdW5kU3RhcnQgPSAwOwogICAgICB0aGlzLmNtLmRvYy5nZXRBbGxNYXJrcygpLmZvckVhY2gobWsgPT4gewogICAgICAgIGlmIChtay5fX2tpbmQpIHsKICAgICAgICAgIG1rLmNsZWFyKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5jbS5lYWNoTGluZShmcm9tLCB0bywgbG4gPT4gewogICAgICAgIGNvbnN0IGxpbmUgPSBsbi5saW5lTm8oKTsKICAgICAgICBpZiAobG4udGV4dC5zdGFydHNXaXRoKCdgYGBkaWFncmFtJykpIHsKICAgICAgICAgIGZvdW5kID0gJ2RpYWdyYW0nOwogICAgICAgICAgZm91bmRTdGFydCA9IGxpbmU7CiAgICAgICAgfSBlbHNlIGlmIChsbi50ZXh0ID09PSAnYGBgJyAmJiBmb3VuZCkgewogICAgICAgICAgc3dpdGNoIChmb3VuZCkgewogICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgLy8gLT4gRElBR1JBTQogICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgY2FzZSAnZGlhZ3JhbSc6CiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKGxpbmUgLSBmb3VuZFN0YXJ0ICE9PSAyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYWRkTWFya2VyKHsKICAgICAgICAgICAgICAgICAga2luZDogJ2RpYWdyYW0nLAogICAgICAgICAgICAgICAgICBmcm9tOiB7CiAgICAgICAgICAgICAgICAgICAgbGluZTogZm91bmRTdGFydCwKICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICB0bzogewogICAgICAgICAgICAgICAgICAgIGxpbmU6IGZvdW5kU3RhcnQsCiAgICAgICAgICAgICAgICAgICAgY2g6IDEwCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHRleHQ6ICdFZGl0IERpYWdyYW0nLAogICAgICAgICAgICAgICAgICBhY3Rpb246ICgoc3RhcnQsIGVuZCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJldHVybiBldiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNtLmRvYy5zZXRTZWxlY3Rpb24oewogICAgICAgICAgICAgICAgICAgICAgICBsaW5lOiBzdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgY2g6IDAKICAgICAgICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGluZTogZW5kLAogICAgICAgICAgICAgICAgICAgICAgICBjaDogMwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYXcgPSB0aGlzLmNtLmRvYy5nZXRMaW5lKGVuZCAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9hY3RpdmVNb2RhbERhdGEnLCBCdWZmZXIuZnJvbShyYXcsICdiYXNlNjQnKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b2dnbGVNb2RhbChgZWRpdG9yTW9kYWxEcmF3aW9gKTsKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuY29tbWl0KCdzaG93Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcHJvY2VzcyBkaWFncmFtIGRhdGEuJywKICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZTogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGljb246ICd3YXJuaW5nJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KShmb3VuZFN0YXJ0LCBsaW5lKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAobG4uaGVpZ2h0ID4gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLmNtLmZvbGRDb2RlKGZvdW5kU3RhcnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZm91bmQgPSBudWxsOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgYWRkTWFya2VyKF9yZWY2KSB7CiAgICAgIGxldCB7CiAgICAgICAga2luZCwKICAgICAgICBmcm9tLAogICAgICAgIHRvLAogICAgICAgIHRleHQsCiAgICAgICAgYWN0aW9uCiAgICAgIH0gPSBfcmVmNjsKICAgICAgY29uc3QgbWFya2VyRWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICBtYXJrZXJFbG0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCkpOwogICAgICBtYXJrZXJFbG0uY2xhc3NOYW1lID0gJ0NvZGVNaXJyb3ItYnV0dG9ubWFya2VyJzsKICAgICAgbWFya2VyRWxtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWN0aW9uKTsKICAgICAgdGhpcy5jbS5tYXJrVGV4dChmcm9tLCB0bywgewogICAgICAgIHJlcGxhY2VkV2l0aDogbWFya2VyRWxtLAogICAgICAgIF9fa2luZDoga2luZAogICAgICB9KTsKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9lZGl0b3JLZXknLCAnbWFya2Rvd24nKTsKICAgIGlmICh0aGlzLm1vZGUgPT09ICdjcmVhdGUnICYmICF0aGlzLiRzdG9yZS5nZXQoJ2VkaXRvci9jb250ZW50JykpIHsKICAgICAgdGhpcy4kc3RvcmUuc2V0KCdlZGl0b3IvY29udGVudCcsICcjIEhlYWRlclxuWW91ciBjb250ZW50IGhlcmUnKTsKICAgIH0KCiAgICAvLyBJbml0aWFsaXplIE1lcm1haWQgQVBJCiAgICBtZXJtYWlkLmluaXRpYWxpemUoewogICAgICBzdGFydE9uTG9hZDogZmFsc2UsCiAgICAgIHRoZW1lOiB0aGlzLiR2dWV0aWZ5LnRoZW1lLmRhcmsgPyBgZGFya2AgOiBgZGVmYXVsdGAKICAgIH0pOwoKICAgIC8vIEluaXRpYWxpemUgQ29kZU1pcnJvcgoKICAgIHRoaXMuY20gPSBDb2RlTWlycm9yLmZyb21UZXh0QXJlYSh0aGlzLiRyZWZzLmNtLCB7CiAgICAgIHRhYlNpemU6IDIsCiAgICAgIG1vZGU6ICd0ZXh0L21hcmtkb3duJywKICAgICAgdGhlbWU6ICd3aWtpanMtZGFyaycsCiAgICAgIGxpbmVOdW1iZXJzOiB0cnVlLAogICAgICBsaW5lV3JhcHBpbmc6IHRydWUsCiAgICAgIGxpbmU6IHRydWUsCiAgICAgIHN0eWxlQWN0aXZlTGluZTogdHJ1ZSwKICAgICAgaGlnaGxpZ2h0U2VsZWN0aW9uTWF0Y2hlczogewogICAgICAgIGFubm90YXRlU2Nyb2xsYmFyOiB0cnVlCiAgICAgIH0sCiAgICAgIHZpZXdwb3J0TWFyZ2luOiA1MCwKICAgICAgaW5wdXRTdHlsZTogJ2NvbnRlbnRlZGl0YWJsZScsCiAgICAgIGFsbG93RHJvcEZpbGVUeXBlczogWydpbWFnZS9qcGcnLCAnaW1hZ2UvcG5nJywgJ2ltYWdlL3N2ZycsICdpbWFnZS9qcGVnJywgJ2ltYWdlL2dpZiddLAogICAgICBkaXJlY3Rpb246IHNpdGVDb25maWcucnRsID8gJ3J0bCcgOiAnbHRyJywKICAgICAgZm9sZEd1dHRlcjogdHJ1ZSwKICAgICAgZ3V0dGVyczogWydDb2RlTWlycm9yLWxpbmVudW1iZXJzJywgJ0NvZGVNaXJyb3ItZm9sZGd1dHRlciddCiAgICB9KTsKICAgIHRoaXMuY20uc2V0VmFsdWUodGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKTsKICAgIHRoaXMuY20ub24oJ2NoYW5nZScsIGMgPT4gewogICAgICB0aGlzLiRzdG9yZS5zZXQoJ2VkaXRvci9jb250ZW50JywgYy5nZXRWYWx1ZSgpKTsKICAgICAgdGhpcy5vbkNtSW5wdXQodGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKTsKICAgIH0pOwogICAgaWYgKHRoaXMuJHZ1ZXRpZnkuYnJlYWtwb2ludC5tZEFuZFVwKSB7CiAgICAgIHRoaXMuY20uc2V0U2l6ZShudWxsLCAnY2FsYygxMDB2aCAtIDExMnB4IC0gMjRweCknKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY20uc2V0U2l6ZShudWxsLCAnY2FsYygxMDB2aCAtIDExMnB4IC0gMTZweCknKTsKICAgIH0KCiAgICAvLyBTZXQgS2V5YmluZGluZ3MKCiAgICBjb25zdCBrZXlCaW5kaW5ncyA9IHsKICAgICAgJ0YxMScoYykgewogICAgICAgIGMuc2V0T3B0aW9uKCdmdWxsU2NyZWVuJywgIWMuZ2V0T3B0aW9uKCdmdWxsU2NyZWVuJykpOwogICAgICB9LAogICAgICAnRXNjJyhjKSB7CiAgICAgICAgaWYgKGMuZ2V0T3B0aW9uKCdmdWxsU2NyZWVuJykpIGMuc2V0T3B0aW9uKCdmdWxsU2NyZWVuJywgZmFsc2UpOwogICAgICB9CiAgICB9OwogICAgX3NldChrZXlCaW5kaW5ncywgYCR7Q3RybEtleX0tU2AsIGMgPT4gewogICAgICB0aGlzLnNhdmUoKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1CYCwgYyA9PiB7CiAgICAgIHRoaXMudG9nZ2xlTWFya3VwKHsKICAgICAgICBzdGFydDogYCoqYAogICAgICB9KTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICBfc2V0KGtleUJpbmRpbmdzLCBgJHtDdHJsS2V5fS1JYCwgYyA9PiB7CiAgICAgIHRoaXMudG9nZ2xlTWFya3VwKHsKICAgICAgICBzdGFydDogYCpgCiAgICAgIH0pOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKICAgIF9zZXQoa2V5QmluZGluZ3MsIGAke0N0cmxLZXl9LUFsdC1SaWdodGAsIGMgPT4gewogICAgICBsZXQgbHZsID0gdGhpcy5nZXRIZWFkZXJMZXZlbChjKTsKICAgICAgaWYgKGx2bCA+PSA2KSB7CiAgICAgICAgbHZsID0gNTsKICAgICAgfQogICAgICB0aGlzLnNldEhlYWRlckxpbmUobHZsICsgMSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwogICAgX3NldChrZXlCaW5kaW5ncywgYCR7Q3RybEtleX0tQWx0LUxlZnRgLCBjID0+IHsKICAgICAgbGV0IGx2bCA9IHRoaXMuZ2V0SGVhZGVyTGV2ZWwoYyk7CiAgICAgIGlmIChsdmwgPD0gMSkgewogICAgICAgIGx2bCA9IDI7CiAgICAgIH0KICAgICAgdGhpcy5zZXRIZWFkZXJMaW5lKGx2bCAtIDEpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9KTsKICAgIHRoaXMuY20uc2V0T3B0aW9uKCdleHRyYUtleXMnLCBrZXlCaW5kaW5ncyk7CiAgICB0aGlzLmNtLm9uKCdpbnB1dFJlYWQnLCB0aGlzLmF1dG9jb21wbGV0ZSk7CgogICAgLy8gSGFuZGxlIGN1cnNvciBtb3ZlbWVudAoKICAgIHRoaXMuY20ub24oJ2N1cnNvckFjdGl2aXR5JywgYyA9PiB7CiAgICAgIHRoaXMucG9zaXRpb25TeW5jKGMpOwogICAgICB0aGlzLnNjcm9sbFN5bmMoYyk7CiAgICB9KTsKCiAgICAvLyBIYW5kbGUgc3BlY2lhbCBwYXN0ZQoKICAgIHRoaXMuY20ub24oJ3Bhc3RlJywgdGhpcy5vbkNtUGFzdGUpOwoKICAgIC8vIFJlbmRlciBpbml0aWFsIHByZXZpZXcKCiAgICB0aGlzLnByb2Nlc3NDb250ZW50KHRoaXMuJHN0b3JlLmdldCgnZWRpdG9yL2NvbnRlbnQnKSk7CiAgICB0aGlzLnJlZnJlc2goKTsKICAgIHRoaXMuJHJvb3QuJG9uKCdlZGl0b3JJbnNlcnQnLCBvcHRzID0+IHsKICAgICAgc3dpdGNoIChvcHRzLmtpbmQpIHsKICAgICAgICBjYXNlICdJTUFHRSc6CiAgICAgICAgICBsZXQgaW1nID0gYCFbJHtvcHRzLnRleHR9XSgke29wdHMucGF0aH0pYDsKICAgICAgICAgIGlmIChvcHRzLmFsaWduICYmIG9wdHMuYWxpZ24gIT09ICcnKSB7CiAgICAgICAgICAgIGltZyArPSBgey5hbGlnbi0ke29wdHMuYWxpZ259fWA7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmluc2VydEF0Q3Vyc29yKHsKICAgICAgICAgICAgY29udGVudDogaW1nCiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ0JJTkFSWSc6CiAgICAgICAgICB0aGlzLmluc2VydEF0Q3Vyc29yKHsKICAgICAgICAgICAgY29udGVudDogYFske29wdHMudGV4dH1dKCR7b3B0cy5wYXRofSlgCiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ0RJQUdSQU0nOgogICAgICAgICAgY29uc3Qgc2VsU3RhcnRMaW5lID0gdGhpcy5jbS5nZXRDdXJzb3IoJ2Zyb20nKS5saW5lOwogICAgICAgICAgY29uc3Qgc2VsRW5kTGluZSA9IHRoaXMuY20uZ2V0Q3Vyc29yKCd0bycpLmxpbmUgKyAxOwogICAgICAgICAgdGhpcy5jbS5kb2MucmVwbGFjZVNlbGVjdGlvbignYGBgZGlhZ3JhbVxuJyArIG9wdHMudGV4dCArICdcbmBgYFxuJywgJ3N0YXJ0Jyk7CiAgICAgICAgICB0aGlzLnByb2Nlc3NNYXJrZXJzKHNlbFN0YXJ0TGluZSwgc2VsRW5kTGluZSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7CgogICAgLy8gSGFuZGxlIHNhdmUgY29uZmxpY3QKICAgIHRoaXMuJHJvb3QuJG9uKCdzYXZlQ29uZmxpY3QnLCAoKSA9PiB7CiAgICAgIHRoaXMudG9nZ2xlTW9kYWwoYGVkaXRvck1vZGFsQ29uZmxpY3RgKTsKICAgIH0pOwogICAgdGhpcy4kcm9vdC4kb24oJ292ZXJ3cml0ZUVkaXRvckNvbnRlbnQnLCAoKSA9PiB7CiAgICAgIHRoaXMuY20uc2V0VmFsdWUodGhpcy4kc3RvcmUuZ2V0KCdlZGl0b3IvY29udGVudCcpKTsKICAgIH0pOwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMuJHJvb3QuJG9mZignZWRpdG9ySW5zZXJ0Jyk7CiAgfQp9Ow=="},null]}