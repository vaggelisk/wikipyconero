{"remainingRequest":"/home/kantro/WebstormProjects/wikipyconero/node_modules/babel-loader/lib/index.js??ref--0-1!/home/kantro/WebstormProjects/wikipyconero/node_modules/webpack-modernizr-loader/index.js!/home/kantro/WebstormProjects/wikipyconero/client/.modernizrrc.js","dependencies":[{"path":"/home/kantro/WebstormProjects/wikipyconero/client/.modernizrrc.js","mtime":1695287603859},{"path":"/home/kantro/WebstormProjects/wikipyconero/.babelrc","mtime":1695287603859},{"path":"/home/kantro/WebstormProjects/wikipyconero/node_modules/cache-loader/dist/cjs.js","mtime":1694896091905},{"path":"/home/kantro/WebstormProjects/wikipyconero/node_modules/babel-loader/lib/index.js","mtime":1694896091857},{"path":"/home/kantro/WebstormProjects/wikipyconero/node_modules/webpack-modernizr-loader/index.js","mtime":1695231288404}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:OwooZnVuY3Rpb24gKHdpbmRvdykgewogIHZhciBoYWRHbG9iYWwgPSAoJ01vZGVybml6cicgaW4gd2luZG93KTsKICB2YXIgb2xkR2xvYmFsID0gd2luZG93Lk1vZGVybml6cjsgLyohCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogbW9kZXJuaXpyIHYzLjEzLjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBCdWlsZCBodHRwczovL21vZGVybml6ci5jb20vZG93bmxvYWQ/LWJhY2tkcm9wZmlsdGVyLXNldGNsYXNzZXMtZG9udG1pbi1jc3NjbGFzc3ByZWZpeDptZHotCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogIEZhcnVrIEF0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgUGF1bCBJcmlzaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICBBbGV4IFNleHRvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICBSeWFuIFNlZGRvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICBQYXRyaWNrIEtldHRuZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgU3R1IENveAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICBSaWNoYXJkIEhlcnJlcmEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgVmVlY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBNSVQgTGljZW5zZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqLwoKICAvKgogICAqIE1vZGVybml6ciB0ZXN0cyB3aGljaCBuYXRpdmUgQ1NTMyBhbmQgSFRNTDUgZmVhdHVyZXMgYXJlIGF2YWlsYWJsZSBpbiB0aGUKICAgKiBjdXJyZW50IFVBIGFuZCBtYWtlcyB0aGUgcmVzdWx0cyBhdmFpbGFibGUgdG8geW91IGluIHR3byB3YXlzOiBhcyBwcm9wZXJ0aWVzIG9uCiAgICogYSBnbG9iYWwgYE1vZGVybml6cmAgb2JqZWN0LCBhbmQgYXMgY2xhc3NlcyBvbiB0aGUgYDxodG1sPmAgZWxlbWVudC4gVGhpcwogICAqIGluZm9ybWF0aW9uIGFsbG93cyB5b3UgdG8gcHJvZ3Jlc3NpdmVseSBlbmhhbmNlIHlvdXIgcGFnZXMgd2l0aCBhIGdyYW51bGFyIGxldmVsCiAgICogb2YgY29udHJvbCBvdmVyIHRoZSBleHBlcmllbmNlLgogICovCgogIDsKICAoZnVuY3Rpb24gKHNjcmlwdEdsb2JhbE9iamVjdCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7CiAgICB2YXIgdGVzdHMgPSBbXTsKCiAgICAvKioKICAgICAqIE1vZGVybml6clByb3RvIGlzIHRoZSBjb25zdHJ1Y3RvciBmb3IgTW9kZXJuaXpyCiAgICAgKgogICAgICogQGNsYXNzCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICovCiAgICB2YXIgTW9kZXJuaXpyUHJvdG8gPSB7CiAgICAgIF92ZXJzaW9uOiAnMy4xMy4wJywKICAgICAgLy8gQW55IHNldHRpbmdzIHRoYXQgZG9uJ3Qgd29yayBhcyBzZXBhcmF0ZSBtb2R1bGVzCiAgICAgIC8vIGNhbiBnbyBpbiBoZXJlIGFzIGNvbmZpZ3VyYXRpb24uCiAgICAgIF9jb25maWc6IHsKICAgICAgICAnY2xhc3NQcmVmaXgnOiAnbWR6LScsCiAgICAgICAgJ2VuYWJsZUNsYXNzZXMnOiB0cnVlLAogICAgICAgICdlbmFibGVKU0NsYXNzJzogdHJ1ZSwKICAgICAgICAndXNlUHJlZml4ZXMnOiB0cnVlCiAgICAgIH0sCiAgICAgIC8vIFF1ZXVlIG9mIHRlc3RzCiAgICAgIF9xOiBbXSwKICAgICAgLy8gU3R1YiB0aGVzZSBmb3IgcGVvcGxlIHdobyBhcmUgbGlzdGVuaW5nCiAgICAgIG9uOiBmdW5jdGlvbiAodGVzdCwgY2IpIHsKICAgICAgICAvLyBJIGRvbid0IHJlYWxseSB0aGluayBwZW9wbGUgc2hvdWxkIGRvIHRoaXMsIGJ1dCB3ZSBjYW4KICAgICAgICAvLyBzYWZlIGd1YXJkIGl0IGEgYml0LgogICAgICAgIC8vIC0tIE5PVEU6OiB0aGlzIGdldHMgV0FZIG92ZXJyaWRkZW4gaW4gc3JjL2FkZFRlc3QgZm9yIGFjdHVhbCBhc3luYyB0ZXN0cy4KICAgICAgICAvLyBUaGlzIGlzIGluIGNhc2UgcGVvcGxlIGxpc3RlbiB0byBzeW5jaHJvbm91cyB0ZXN0cy4gSSB3b3VsZCBsZWF2ZSBpdCBvdXQsCiAgICAgICAgLy8gYnV0IHRoZSBjb2RlIHRvICpkaXNhbGxvdyogc3luYyB0ZXN0cyBpbiB0aGUgcmVhbCB2ZXJzaW9uIG9mIHRoaXMKICAgICAgICAvLyBmdW5jdGlvbiBpcyBhY3R1YWxseSBsYXJnZXIgdGhhbiB0aGlzLgogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNiKHNlbGZbdGVzdF0pOwogICAgICAgIH0sIDApOwogICAgICB9LAogICAgICBhZGRUZXN0OiBmdW5jdGlvbiAobmFtZSwgZm4sIG9wdGlvbnMpIHsKICAgICAgICB0ZXN0cy5wdXNoKHsKICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICBmbjogZm4sCiAgICAgICAgICBvcHRpb25zOiBvcHRpb25zCiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIGFkZEFzeW5jVGVzdDogZnVuY3Rpb24gKGZuKSB7CiAgICAgICAgdGVzdHMucHVzaCh7CiAgICAgICAgICBuYW1lOiBudWxsLAogICAgICAgICAgZm46IGZuCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLy8gRmFrZSBzb21lIG9mIE9iamVjdC5jcmVhdGUgc28gd2UgY2FuIGZvcmNlIG5vbiB0ZXN0IHJlc3VsdHMgdG8gYmUgbm9uICJvd24iIHByb3BlcnRpZXMuCiAgICB2YXIgTW9kZXJuaXpyID0gZnVuY3Rpb24gKCkge307CiAgICBNb2Rlcm5penIucHJvdG90eXBlID0gTW9kZXJuaXpyUHJvdG87CgogICAgLy8gTGVhayBtb2Rlcm5penIgZ2xvYmFsbHkgd2hlbiB5b3UgYHJlcXVpcmVgIGl0IHJhdGhlciB0aGFuIGZvcmNlIGl0IGhlcmUuCiAgICAvLyBPdmVyd3JpdGUgbmFtZSBzbyBjb25zdHJ1Y3RvciBuYW1lIGlzIG5pY2VyIDpECiAgICBNb2Rlcm5penIgPSBuZXcgTW9kZXJuaXpyKCk7CiAgICB2YXIgY2xhc3NlcyA9IFtdOwoKICAgIC8qKgogICAgICogaXMgcmV0dXJucyBhIGJvb2xlYW4gaWYgdGhlIHR5cGVvZiBhbiBvYmogaXMgZXhhY3RseSB0eXBlLgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGlzCiAgICAgKiBAcGFyYW0geyp9IG9iaiAtIEEgdGhpbmcgd2Ugd2FudCB0byBjaGVjayB0aGUgdHlwZSBvZgogICAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBBIHN0cmluZyB0byBjb21wYXJlIHRoZSB0eXBlb2YgYWdhaW5zdAogICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIHR5cGVvZiB0aGUgZmlyc3QgcGFyYW1ldGVyIGlzIGV4YWN0bHkgdGhlIHNwZWNpZmllZCB0eXBlLCBmYWxzZSBvdGhlcndpc2UKICAgICAqLwogICAgZnVuY3Rpb24gaXMob2JqLCB0eXBlKSB7CiAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSB0eXBlOwogICAgfQogICAgOwoKICAgIC8qKgogICAgICogUnVuIHRocm91Z2ggYWxsIHRlc3RzIGFuZCBkZXRlY3QgdGhlaXIgc3VwcG9ydCBpbiB0aGUgY3VycmVudCBVQS4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEByZXR1cm5zIHt2b2lkfQogICAgICovCiAgICBmdW5jdGlvbiB0ZXN0UnVubmVyKCkgewogICAgICB2YXIgZmVhdHVyZU5hbWVzOwogICAgICB2YXIgZmVhdHVyZTsKICAgICAgdmFyIGFsaWFzSWR4OwogICAgICB2YXIgcmVzdWx0OwogICAgICB2YXIgbmFtZUlkeDsKICAgICAgdmFyIGZlYXR1cmVOYW1lOwogICAgICB2YXIgZmVhdHVyZU5hbWVTcGxpdDsKICAgICAgZm9yICh2YXIgZmVhdHVyZUlkeCBpbiB0ZXN0cykgewogICAgICAgIGlmICh0ZXN0cy5oYXNPd25Qcm9wZXJ0eShmZWF0dXJlSWR4KSkgewogICAgICAgICAgZmVhdHVyZU5hbWVzID0gW107CiAgICAgICAgICBmZWF0dXJlID0gdGVzdHNbZmVhdHVyZUlkeF07CiAgICAgICAgICAvLyBydW4gdGhlIHRlc3QsIHRocm93IHRoZSByZXR1cm4gdmFsdWUgaW50byB0aGUgTW9kZXJuaXpyLAogICAgICAgICAgLy8gdGhlbiBiYXNlZCBvbiB0aGF0IGJvb2xlYW4sIGRlZmluZSBhbiBhcHByb3ByaWF0ZSBjbGFzc05hbWUKICAgICAgICAgIC8vIGFuZCBwdXNoIGl0IGludG8gYW4gYXJyYXkgb2YgY2xhc3NlcyB3ZSdsbCBqb2luIGxhdGVyLgogICAgICAgICAgLy8KICAgICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIG5hbWUsIGl0J3MgYW4gJ2FzeW5jJyB0ZXN0IHRoYXQgaXMgcnVuLAogICAgICAgICAgLy8gYnV0IG5vdCBkaXJlY3RseSBhZGRlZCB0byB0aGUgb2JqZWN0LiBUaGF0IHNob3VsZAogICAgICAgICAgLy8gYmUgZG9uZSB3aXRoIGEgcG9zdC1ydW4gYWRkVGVzdCBjYWxsLgogICAgICAgICAgaWYgKGZlYXR1cmUubmFtZSkgewogICAgICAgICAgICBmZWF0dXJlTmFtZXMucHVzaChmZWF0dXJlLm5hbWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgIGlmIChmZWF0dXJlLm9wdGlvbnMgJiYgZmVhdHVyZS5vcHRpb25zLmFsaWFzZXMgJiYgZmVhdHVyZS5vcHRpb25zLmFsaWFzZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgLy8gQWRkIGFsbCB0aGUgYWxpYXNlcyBpbnRvIHRoZSBuYW1lcyBsaXN0CiAgICAgICAgICAgICAgZm9yIChhbGlhc0lkeCA9IDA7IGFsaWFzSWR4IDwgZmVhdHVyZS5vcHRpb25zLmFsaWFzZXMubGVuZ3RoOyBhbGlhc0lkeCsrKSB7CiAgICAgICAgICAgICAgICBmZWF0dXJlTmFtZXMucHVzaChmZWF0dXJlLm9wdGlvbnMuYWxpYXNlc1thbGlhc0lkeF0udG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gUnVuIHRoZSB0ZXN0LCBvciB1c2UgdGhlIHJhdyB2YWx1ZSBpZiBpdCdzIG5vdCBhIGZ1bmN0aW9uCiAgICAgICAgICByZXN1bHQgPSBpcyhmZWF0dXJlLmZuLCAnZnVuY3Rpb24nKSA/IGZlYXR1cmUuZm4oKSA6IGZlYXR1cmUuZm47CgogICAgICAgICAgLy8gU2V0IGVhY2ggb2YgdGhlIG5hbWVzIG9uIHRoZSBNb2Rlcm5penIgb2JqZWN0CiAgICAgICAgICBmb3IgKG5hbWVJZHggPSAwOyBuYW1lSWR4IDwgZmVhdHVyZU5hbWVzLmxlbmd0aDsgbmFtZUlkeCsrKSB7CiAgICAgICAgICAgIGZlYXR1cmVOYW1lID0gZmVhdHVyZU5hbWVzW25hbWVJZHhdOwogICAgICAgICAgICAvLyBTdXBwb3J0IGRvdCBwcm9wZXJ0aWVzIGFzIHN1YiB0ZXN0cy4gV2UgZG9uJ3QgZG8gY2hlY2tpbmcgdG8gbWFrZSBzdXJlCiAgICAgICAgICAgIC8vIHRoYXQgdGhlIGltcGxpZWQgcGFyZW50IHRlc3RzIGhhdmUgYmVlbiBhZGRlZC4gWW91IG11c3QgY2FsbCB0aGVtIGluCiAgICAgICAgICAgIC8vIG9yZGVyIChlaXRoZXIgaW4gdGhlIHRlc3QsIG9yIG1ha2UgdGhlIHBhcmVudCB0ZXN0IGEgZGVwZW5kZW5jeSkuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIENhcCBpdCB0byBUV08gdG8gbWFrZSB0aGUgbG9naWMgc2ltcGxlIGFuZCBiZWNhdXNlIHdobyBuZWVkcyB0aGF0IGtpbmQgb2Ygc3VidGVzdGluZwogICAgICAgICAgICAvLyBoYXNodGFnIGZhbW91cyBsYXN0IHdvcmRzCiAgICAgICAgICAgIGZlYXR1cmVOYW1lU3BsaXQgPSBmZWF0dXJlTmFtZS5zcGxpdCgnLicpOwogICAgICAgICAgICBpZiAoZmVhdHVyZU5hbWVTcGxpdC5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICBNb2Rlcm5penJbZmVhdHVyZU5hbWVTcGxpdFswXV0gPSByZXN1bHQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gY2FzdCB0byBhIEJvb2xlYW4sIGlmIG5vdCBvbmUgYWxyZWFkeSBvciBpZiBpdCBkb2VzbnQgZXhpc3QgeWV0IChsaWtlIGlucHV0dHlwZXMpCiAgICAgICAgICAgICAgaWYgKCFNb2Rlcm5penJbZmVhdHVyZU5hbWVTcGxpdFswXV0gfHwgTW9kZXJuaXpyW2ZlYXR1cmVOYW1lU3BsaXRbMF1dICYmICEoTW9kZXJuaXpyW2ZlYXR1cmVOYW1lU3BsaXRbMF1dIGluc3RhbmNlb2YgQm9vbGVhbikpIHsKICAgICAgICAgICAgICAgIE1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXSA9IG5ldyBCb29sZWFuKE1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIE1vZGVybml6cltmZWF0dXJlTmFtZVNwbGl0WzBdXVtmZWF0dXJlTmFtZVNwbGl0WzFdXSA9IHJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjbGFzc2VzLnB1c2goKHJlc3VsdCA/ICcnIDogJ25vLScpICsgZmVhdHVyZU5hbWVTcGxpdC5qb2luKCctJykpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgOwoKICAgIC8qKgogICAgICogZG9jRWxlbWVudCBpcyBhIGNvbnZlbmllbmNlIHdyYXBwZXIgdG8gZ3JhYiB0aGUgcm9vdCBlbGVtZW50IG9mIHRoZSBkb2N1bWVudAogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQHJldHVybnMge0hUTUxFbGVtZW50fFNWR0VsZW1lbnR9IFRoZSByb290IGVsZW1lbnQgb2YgdGhlIGRvY3VtZW50CiAgICAgKi8KICAgIHZhciBkb2NFbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKICAgIC8qKgogICAgICogQSBjb252ZW5pZW5jZSBoZWxwZXIgdG8gY2hlY2sgaWYgdGhlIGRvY3VtZW50IHdlIGFyZSBydW5uaW5nIGluIGlzIGFuIFNWRyBkb2N1bWVudAogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQHJldHVybnMge2Jvb2xlYW59CiAgICAgKi8KICAgIHZhciBpc1NWRyA9IGRvY0VsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3N2Zyc7CgogICAgLyoqCiAgICAgKiBzZXRDbGFzc2VzIHRha2VzIGFuIGFycmF5IG9mIGNsYXNzIG5hbWVzIGFuZCBhZGRzIHRoZW0gdG8gdGhlIHJvb3QgZWxlbWVudAogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIHNldENsYXNzZXMKICAgICAqIEBwYXJhbSB7c3RyaW5nW119IGNsYXNzZXMgLSBBcnJheSBvZiBjbGFzcyBuYW1lcwogICAgICovCiAgICAvLyBQYXNzIGluIGFuIGFuZCBhcnJheSBvZiBjbGFzcyBuYW1lcywgZS5nLjoKICAgIC8vICBbJ25vLXdlYnAnLCAnYm9yZGVycmFkaXVzJywgLi4uXQogICAgZnVuY3Rpb24gc2V0Q2xhc3NlcyhjbGFzc2VzKSB7CiAgICAgIHZhciBjbGFzc05hbWUgPSBkb2NFbGVtZW50LmNsYXNzTmFtZTsKICAgICAgdmFyIGNsYXNzUHJlZml4ID0gTW9kZXJuaXpyLl9jb25maWcuY2xhc3NQcmVmaXggfHwgJyc7CiAgICAgIGlmIChpc1NWRykgewogICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS5iYXNlVmFsOwogICAgICB9CgogICAgICAvLyBDaGFuZ2UgYG5vLWpzYCB0byBganNgIChpbmRlcGVuZGVudGx5IG9mIHRoZSBgZW5hYmxlQ2xhc3Nlc2Agb3B0aW9uKQogICAgICAvLyBIYW5kbGUgY2xhc3NQcmVmaXggb24gdGhpcyB0b28KICAgICAgaWYgKE1vZGVybml6ci5fY29uZmlnLmVuYWJsZUpTQ2xhc3MpIHsKICAgICAgICB2YXIgcmVKUyA9IG5ldyBSZWdFeHAoJyhefFxccyknICsgY2xhc3NQcmVmaXggKyAnbm8tanMoXFxzfCQpJyk7CiAgICAgICAgY2xhc3NOYW1lID0gY2xhc3NOYW1lLnJlcGxhY2UocmVKUywgJyQxJyArIGNsYXNzUHJlZml4ICsgJ2pzJDInKTsKICAgICAgfQogICAgICBpZiAoTW9kZXJuaXpyLl9jb25maWcuZW5hYmxlQ2xhc3NlcykgewogICAgICAgIC8vIEFkZCB0aGUgbmV3IGNsYXNzZXMKICAgICAgICBpZiAoY2xhc3Nlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjbGFzc05hbWUgKz0gJyAnICsgY2xhc3NQcmVmaXggKyBjbGFzc2VzLmpvaW4oJyAnICsgY2xhc3NQcmVmaXgpOwogICAgICAgIH0KICAgICAgICBpZiAoaXNTVkcpIHsKICAgICAgICAgIGRvY0VsZW1lbnQuY2xhc3NOYW1lLmJhc2VWYWwgPSBjbGFzc05hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRvY0VsZW1lbnQuY2xhc3NOYW1lID0gY2xhc3NOYW1lOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgOwoKICAgIC8qKgogICAgICogSWYgdGhlIGJyb3dzZXJzIGZvbGxvdyB0aGUgc3BlYywgdGhlbiB0aGV5IHdvdWxkIGV4cG9zZSB2ZW5kb3Itc3BlY2lmaWMgc3R5bGVzIGFzOgogICAgICogICBlbGVtLnN0eWxlLldlYmtpdEJvcmRlclJhZGl1cwogICAgICogaW5zdGVhZCBvZiBzb21ldGhpbmcgbGlrZSB0aGUgZm9sbG93aW5nICh3aGljaCBpcyB0ZWNobmljYWxseSBpbmNvcnJlY3QpOgogICAgICogICBlbGVtLnN0eWxlLndlYmtpdEJvcmRlclJhZGl1cwogICAgICoKICAgICAqIFdlYktpdCBnaG9zdHMgdGhlaXIgcHJvcGVydGllcyBpbiBsb3dlcmNhc2UgYnV0IE9wZXJhICYgTW96IGRvIG5vdC4KICAgICAqIE1pY3Jvc29mdCB1c2VzIGEgbG93ZXJjYXNlIGBtc2AgaW5zdGVhZCBvZiB0aGUgY29ycmVjdCBgTXNgIGluIElFOCsKICAgICAqICAgZXJpay5lYWUubmV0L2FyY2hpdmVzLzIwMDgvMDMvMTAvMjEuNDguMTAvCiAgICAgKgogICAgICogTW9yZSBoZXJlOiBnaXRodWIuY29tL01vZGVybml6ci9Nb2Rlcm5penIvaXNzdWVzL2lzc3VlLzIxCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdmVuZG9yLXNwZWNpZmljIHN0eWxlIHByb3BlcnRpZXMKICAgICAqLwogICAgdmFyIG9tUHJlZml4ZXMgPSAnTW96IE8gbXMgV2Via2l0JzsKICAgIHZhciBjc3NvbVByZWZpeGVzID0gTW9kZXJuaXpyUHJvdG8uX2NvbmZpZy51c2VQcmVmaXhlcyA/IG9tUHJlZml4ZXMuc3BsaXQoJyAnKSA6IFtdOwogICAgTW9kZXJuaXpyUHJvdG8uX2Nzc29tUHJlZml4ZXMgPSBjc3NvbVByZWZpeGVzOwoKICAgIC8qKgogICAgICogY29udGFpbnMgY2hlY2tzIHRvIHNlZSBpZiBhIHN0cmluZyBjb250YWlucyBhbm90aGVyIHN0cmluZwogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIGNvbnRhaW5zCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyIC0gVGhlIHN0cmluZyB3ZSB3YW50IHRvIGNoZWNrIGZvciBzdWJzdHJpbmdzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3Vic3RyIC0gVGhlIHN1YnN0cmluZyB3ZSB3YW50IHRvIHNlYXJjaCB0aGUgZmlyc3Qgc3RyaW5nIGZvcgogICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgYW5kIG9ubHkgaWYgdGhlIGZpcnN0IHN0cmluZyAnc3RyJyBjb250YWlucyB0aGUgc2Vjb25kIHN0cmluZyAnc3Vic3RyJwogICAgICovCiAgICBmdW5jdGlvbiBjb250YWlucyhzdHIsIHN1YnN0cikgewogICAgICByZXR1cm4gISF+KCcnICsgc3RyKS5pbmRleE9mKHN1YnN0cik7CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiBjcmVhdGVFbGVtZW50IGlzIGEgY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgZG9jdW1lbnQuY3JlYXRlRWxlbWVudC4gU2luY2Ugd2UKICAgICAqIHVzZSBjcmVhdGVFbGVtZW50IGFsbCBvdmVyIHRoZSBwbGFjZSwgdGhpcyBhbGxvd3MgZm9yIChzbGlnaHRseSkgc21hbGxlciBjb2RlCiAgICAgKiBhcyB3ZWxsIGFzIGFic3RyYWN0aW5nIGF3YXkgaXNzdWVzIHdpdGggY3JlYXRpbmcgZWxlbWVudHMgaW4gY29udGV4dHMgb3RoZXIgdGhhbgogICAgICogSFRNTCBkb2N1bWVudHMgKGUuZy4gU1ZHIGRvY3VtZW50cykuCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gY3JlYXRlRWxlbWVudAogICAgICogQHJldHVybnMge0hUTUxFbGVtZW50fFNWR0VsZW1lbnR9IEFuIEhUTUwgb3IgU1ZHIGVsZW1lbnQKICAgICAqLwogICAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudCgpIHsKICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgLy8gVGhpcyBpcyB0aGUgY2FzZSBpbiBJRTcsIHdoZXJlIHRoZSB0eXBlIG9mIGNyZWF0ZUVsZW1lbnQgaXMgIm9iamVjdCIuCiAgICAgICAgLy8gRm9yIHRoaXMgcmVhc29uLCB3ZSBjYW5ub3QgY2FsbCBhcHBseSgpIGFzIE9iamVjdCBpcyBub3QgYSBGdW5jdGlvbi4KICAgICAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChhcmd1bWVudHNbMF0pOwogICAgICB9IGVsc2UgaWYgKGlzU1ZHKSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUy5jYWxsKGRvY3VtZW50LCAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCBhcmd1bWVudHNbMF0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50LmFwcGx5KGRvY3VtZW50LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiBDcmVhdGUgb3VyICJtb2Rlcm5penIiIGVsZW1lbnQgdGhhdCB3ZSBkbyBtb3N0IGZlYXR1cmUgdGVzdHMgb24uCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKi8KICAgIHZhciBtb2RFbGVtID0gewogICAgICBlbGVtOiBjcmVhdGVFbGVtZW50KCdtb2Rlcm5penInKQogICAgfTsKCiAgICAvLyBDbGVhbiB1cCB0aGlzIGVsZW1lbnQKICAgIE1vZGVybml6ci5fcS5wdXNoKGZ1bmN0aW9uICgpIHsKICAgICAgZGVsZXRlIG1vZEVsZW0uZWxlbTsKICAgIH0pOwogICAgdmFyIG1TdHlsZSA9IHsKICAgICAgc3R5bGU6IG1vZEVsZW0uZWxlbS5zdHlsZQogICAgfTsKCiAgICAvLyBraWxsIHJlZiBmb3IgZ2MsIG11c3QgaGFwcGVuIGJlZm9yZSBtb2QuZWxlbSBpcyByZW1vdmVkLCBzbyB3ZSB1bnNoaWZ0IG9uIHRvCiAgICAvLyB0aGUgZnJvbnQgb2YgdGhlIHF1ZXVlLgogICAgTW9kZXJuaXpyLl9xLnVuc2hpZnQoZnVuY3Rpb24gKCkgewogICAgICBkZWxldGUgbVN0eWxlLnN0eWxlOwogICAgfSk7CgogICAgLyoqCiAgICAgKiBnZXRCb2R5IHJldHVybnMgdGhlIGJvZHkgb2YgYSBkb2N1bWVudCwgb3IgYW4gZWxlbWVudCB0aGF0IGNhbiBzdGFuZCBpbiBmb3IKICAgICAqIHRoZSBib2R5IGlmIGEgcmVhbCBib2R5IGRvZXMgbm90IGV4aXN0CiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gZ2V0Qm9keQogICAgICogQHJldHVybnMge0hUTUxFbGVtZW50fFNWR0VsZW1lbnR9IFJldHVybnMgdGhlIHJlYWwgYm9keSBvZiBhIGRvY3VtZW50LCBvciBhbgogICAgICogYXJ0aWZpY2lhbGx5IGNyZWF0ZWQgZWxlbWVudCB0aGF0IHN0YW5kcyBpbiBmb3IgdGhlIGJvZHkKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0Qm9keSgpIHsKICAgICAgLy8gQWZ0ZXIgcGFnZSBsb2FkIGluamVjdGluZyBhIGZha2UgYm9keSBkb2Vzbid0IHdvcmsgc28gY2hlY2sgaWYgYm9keSBleGlzdHMKICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5OwogICAgICBpZiAoIWJvZHkpIHsKICAgICAgICAvLyBDYW4ndCB1c2UgdGhlIHJlYWwgYm9keSBjcmVhdGUgYSBmYWtlIG9uZS4KICAgICAgICBib2R5ID0gY3JlYXRlRWxlbWVudChpc1NWRyA/ICdzdmcnIDogJ2JvZHknKTsKICAgICAgICBib2R5LmZha2UgPSB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiBib2R5OwogICAgfQogICAgOwoKICAgIC8qKgogICAgICogaW5qZWN0RWxlbWVudFdpdGhTdHlsZXMgaW5qZWN0cyBhbiBlbGVtZW50IHdpdGggc3R5bGUgZWxlbWVudCBhbmQgc29tZSBDU1MgcnVsZXMKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBpbmplY3RFbGVtZW50V2l0aFN0eWxlcwogICAgICogQHBhcmFtIHtzdHJpbmd9IHJ1bGUgLSBTdHJpbmcgcmVwcmVzZW50aW5nIGEgY3NzIHJ1bGUKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIC0gQSBmdW5jdGlvbiB0aGF0IGlzIHVzZWQgdG8gdGVzdCB0aGUgaW5qZWN0ZWQgZWxlbWVudAogICAgICogQHBhcmFtIHtudW1iZXJ9IFtub2Rlc10gLSBBbiBpbnRlZ2VyIHJlcHJlc2VudGluZyB0aGUgbnVtYmVyIG9mIGFkZGl0aW9uYWwgbm9kZXMgeW91IHdhbnQgaW5qZWN0ZWQKICAgICAqIEBwYXJhbSB7c3RyaW5nW119IFt0ZXN0bmFtZXNdIC0gQW4gYXJyYXkgb2Ygc3RyaW5ncyB0aGF0IGFyZSB1c2VkIGFzIGlkcyBmb3IgdGhlIGFkZGl0aW9uYWwgbm9kZXMKICAgICAqIEByZXR1cm5zIHtib29sZWFufSB0aGUgcmVzdWx0IG9mIHRoZSBzcGVjaWZpZWQgY2FsbGJhY2sgdGVzdAogICAgICovCiAgICBmdW5jdGlvbiBpbmplY3RFbGVtZW50V2l0aFN0eWxlcyhydWxlLCBjYWxsYmFjaywgbm9kZXMsIHRlc3RuYW1lcykgewogICAgICB2YXIgbW9kID0gJ21vZGVybml6cic7CiAgICAgIHZhciBzdHlsZTsKICAgICAgdmFyIHJldDsKICAgICAgdmFyIG5vZGU7CiAgICAgIHZhciBkb2NPdmVyZmxvdzsKICAgICAgdmFyIGRpdiA9IGNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgYm9keSA9IGdldEJvZHkoKTsKICAgICAgaWYgKHBhcnNlSW50KG5vZGVzLCAxMCkpIHsKICAgICAgICAvLyBJbiBvcmRlciBub3QgdG8gZ2l2ZSBmYWxzZSBwb3NpdGl2ZXMgd2UgY3JlYXRlIGEgbm9kZSBmb3IgZWFjaCB0ZXN0CiAgICAgICAgLy8gVGhpcyBhbHNvIGFsbG93cyB0aGUgbWV0aG9kIHRvIHNjYWxlIGZvciB1bnNwZWNpZmllZCB1c2VzCiAgICAgICAgd2hpbGUgKG5vZGVzLS0pIHsKICAgICAgICAgIG5vZGUgPSBjcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgIG5vZGUuaWQgPSB0ZXN0bmFtZXMgPyB0ZXN0bmFtZXNbbm9kZXNdIDogbW9kICsgKG5vZGVzICsgMSk7CiAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQobm9kZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0eWxlID0gY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgc3R5bGUudHlwZSA9ICd0ZXh0L2Nzcyc7CiAgICAgIHN0eWxlLmlkID0gJ3MnICsgbW9kOwoKICAgICAgLy8gSUU2IHdpbGwgZmFsc2UgcG9zaXRpdmUgb24gc29tZSB0ZXN0cyBkdWUgdG8gdGhlIHN0eWxlIGVsZW1lbnQgaW5zaWRlIHRoZSB0ZXN0IGRpdiBzb21laG93IGludGVyZmVyaW5nIG9mZnNldEhlaWdodCwgc28gaW5zZXJ0IGl0IGludG8gYm9keSBvciBmYWtlYm9keS4KICAgICAgLy8gT3BlcmEgd2lsbCBhY3QgYWxsIHF1aXJreSB3aGVuIGluamVjdGluZyBlbGVtZW50cyBpbiBkb2N1bWVudEVsZW1lbnQgd2hlbiBwYWdlIGlzIHNlcnZlZCBhcyB4bWwsIG5lZWRzIGZha2Vib2R5IHRvby4gIzI3MAogICAgICAoIWJvZHkuZmFrZSA/IGRpdiA6IGJvZHkpLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgICAgYm9keS5hcHBlbmRDaGlsZChkaXYpOwogICAgICBpZiAoc3R5bGUuc3R5bGVTaGVldCkgewogICAgICAgIHN0eWxlLnN0eWxlU2hlZXQuY3NzVGV4dCA9IHJ1bGU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocnVsZSkpOwogICAgICB9CiAgICAgIGRpdi5pZCA9IG1vZDsKICAgICAgaWYgKGJvZHkuZmFrZSkgewogICAgICAgIC8vYXZvaWQgY3Jhc2hpbmcgSUU4LCBpZiBiYWNrZ3JvdW5kIGltYWdlIGlzIHVzZWQKICAgICAgICBib2R5LnN0eWxlLmJhY2tncm91bmQgPSAnJzsKICAgICAgICAvL1NhZmFyaSA1LjEzLzUuMS40IE9TWCBzdG9wcyBsb2FkaW5nIGlmIDo6LXdlYmtpdC1zY3JvbGxiYXIgaXMgdXNlZCBhbmQgc2Nyb2xsYmFycyBhcmUgdmlzaWJsZQogICAgICAgIGJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJzsKICAgICAgICBkb2NPdmVyZmxvdyA9IGRvY0VsZW1lbnQuc3R5bGUub3ZlcmZsb3c7CiAgICAgICAgZG9jRWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nOwogICAgICAgIGRvY0VsZW1lbnQuYXBwZW5kQ2hpbGQoYm9keSk7CiAgICAgIH0KICAgICAgcmV0ID0gY2FsbGJhY2soZGl2LCBydWxlKTsKICAgICAgLy8gSWYgdGhpcyBpcyBkb25lIGFmdGVyIHBhZ2UgbG9hZCB3ZSBkb24ndCB3YW50IHRvIHJlbW92ZSB0aGUgYm9keSBzbyBjaGVjayBpZiBib2R5IGV4aXN0cwogICAgICBpZiAoYm9keS5mYWtlICYmIGJvZHkucGFyZW50Tm9kZSkgewogICAgICAgIGJvZHkucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChib2R5KTsKICAgICAgICBkb2NFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gZG9jT3ZlcmZsb3c7CiAgICAgICAgLy8gVHJpZ2dlciBsYXlvdXQgc28ga2luZXRpYyBzY3JvbGxpbmcgaXNuJ3QgZGlzYWJsZWQgaW4gaU9TNisKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKICAgICAgICBkb2NFbGVtZW50Lm9mZnNldEhlaWdodDsKICAgICAgfSBlbHNlIHsKICAgICAgICBkaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkaXYpOwogICAgICB9CiAgICAgIHJldHVybiAhIXJldDsKICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIGRvbVRvQ1NTIHRha2VzIGEgY2FtZWxDYXNlIHN0cmluZyBhbmQgY29udmVydHMgaXQgdG8gaHlwaGVuLWNhc2UKICAgICAqIGUuZy4gYm94U2l6aW5nIC0+IGJveC1zaXppbmcKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBkb21Ub0NTUwogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBTdHJpbmcgbmFtZSBvZiBjYW1lbENhc2UgcHJvcCB3ZSB3YW50IHRvIGNvbnZlcnQKICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBoeXBoZW4tY2FzZSB2ZXJzaW9uIG9mIHRoZSBzdXBwbGllZCBuYW1lCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRvbVRvQ1NTKG5hbWUpIHsKICAgICAgcmV0dXJuIG5hbWUucmVwbGFjZSgvKFtBLVpdKS9nLCBmdW5jdGlvbiAoc3RyLCBtMSkgewogICAgICAgIHJldHVybiAnLScgKyBtMS50b0xvd2VyQ2FzZSgpOwogICAgICB9KS5yZXBsYWNlKC9ebXMtLywgJy1tcy0nKTsKICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIHdyYXBwZXIgYXJvdW5kIGdldENvbXB1dGVkU3R5bGUsIHRvIGZpeCBpc3N1ZXMgd2l0aCBGaXJlZm94IHJldHVybmluZyBudWxsIHdoZW4KICAgICAqIGNhbGxlZCBpbnNpZGUgb2YgYSBoaWRkZW4gaWZyYW1lCiAgICAgKgogICAgICogQGFjY2VzcyBwcml2YXRlCiAgICAgKiBAZnVuY3Rpb24gY29tcHV0ZWRTdHlsZQogICAgICogQHBhcmFtIHtIVE1MRWxlbWVudHxTVkdFbGVtZW50fSBlbGVtIC0gVGhlIGVsZW1lbnQgd2Ugd2FudCB0byBmaW5kIHRoZSBjb21wdXRlZCBzdHlsZXMgb2YKICAgICAqIEBwYXJhbSB7c3RyaW5nfG51bGx9IFtwc2V1ZG9dIC0gQW4gb3B0aW9uYWwgcHNldWRvIGVsZW1lbnQgc2VsZWN0b3IgKGUuZy4gOmJlZm9yZSksIG9mIG51bGwgaWYgbm9uZQogICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3AgLSBBIENTUyBwcm9wZXJ0eQogICAgICogQHJldHVybnMge0NTU1N0eWxlRGVjbGFyYXRpb259IHRoZSB2YWx1ZSBvZiB0aGUgc3BlY2lmaWVkIENTUyBwcm9wZXJ0eQogICAgICovCiAgICBmdW5jdGlvbiBjb21wdXRlZFN0eWxlKGVsZW0sIHBzZXVkbywgcHJvcCkgewogICAgICB2YXIgcmVzdWx0OwogICAgICBpZiAoJ2dldENvbXB1dGVkU3R5bGUnIGluIHdpbmRvdykgewogICAgICAgIHJlc3VsdCA9IGdldENvbXB1dGVkU3R5bGUuY2FsbCh3aW5kb3csIGVsZW0sIHBzZXVkbyk7CiAgICAgICAgdmFyIGNvbnNvbGUgPSB3aW5kb3cuY29uc29sZTsKICAgICAgICBpZiAocmVzdWx0ICE9PSBudWxsKSB7CiAgICAgICAgICBpZiAocHJvcCkgewogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGNvbnNvbGUpIHsKICAgICAgICAgICAgdmFyIG1ldGhvZCA9IGNvbnNvbGUuZXJyb3IgPyAnZXJyb3InIDogJ2xvZyc7CiAgICAgICAgICAgIGNvbnNvbGVbbWV0aG9kXS5jYWxsKGNvbnNvbGUsICdnZXRDb21wdXRlZFN0eWxlIHJldHVybmluZyBudWxsLCBpdHMgcG9zc2libGUgbW9kZXJuaXpyIHRlc3QgcmVzdWx0cyBhcmUgaW5hY2N1cmF0ZScpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgPSAhcHNldWRvICYmIGVsZW0uY3VycmVudFN0eWxlICYmIGVsZW0uY3VycmVudFN0eWxlW3Byb3BdOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiBuYXRpdmVUZXN0UHJvcHMgYWxsb3dzIGZvciB1cyB0byB1c2UgbmF0aXZlIGZlYXR1cmUgZGV0ZWN0aW9uIGZ1bmN0aW9uYWxpdHkgaWYgYXZhaWxhYmxlLgogICAgICogc29tZSBwcmVmaXhlZCBmb3JtLCBvciBmYWxzZSwgaW4gdGhlIGNhc2Ugb2YgYW4gdW5zdXBwb3J0ZWQgcnVsZQogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIG5hdGl2ZVRlc3RQcm9wcwogICAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgLSBBbiBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcwogICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSB2YWx1ZSB3ZSB3YW50IHRvIGNoZWNrIHZpYSBAc3VwcG9ydHMKICAgICAqIEByZXR1cm5zIHtib29sZWFufHVuZGVmaW5lZH0gQSBib29sZWFuIHdoZW4gQHN1cHBvcnRzIGV4aXN0cywgdW5kZWZpbmVkIG90aGVyd2lzZQogICAgICovCiAgICAvLyBBY2NlcHRzIGEgbGlzdCBvZiBwcm9wZXJ0eSBuYW1lcyBhbmQgYSBzaW5nbGUgdmFsdWUKICAgIC8vIFJldHVybnMgYHVuZGVmaW5lZGAgaWYgbmF0aXZlIGRldGVjdGlvbiBub3QgYXZhaWxhYmxlCiAgICBmdW5jdGlvbiBuYXRpdmVUZXN0UHJvcHMocHJvcHMsIHZhbHVlKSB7CiAgICAgIHZhciBpID0gcHJvcHMubGVuZ3RoOwogICAgICAvLyBTdGFydCB3aXRoIHRoZSBKUyBBUEk6IGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MzLWNvbmRpdGlvbmFsLyN0aGUtY3NzLWludGVyZmFjZQogICAgICBpZiAoJ0NTUycgaW4gd2luZG93ICYmICdzdXBwb3J0cycgaW4gd2luZG93LkNTUykgewogICAgICAgIC8vIFRyeSBldmVyeSBwcmVmaXhlZCB2YXJpYW50IG9mIHRoZSBwcm9wZXJ0eQogICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgIGlmICh3aW5kb3cuQ1NTLnN1cHBvcnRzKGRvbVRvQ1NTKHByb3BzW2ldKSwgdmFsdWUpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgLy8gT3RoZXJ3aXNlIGZhbGwgYmFjayB0byBhdC1ydWxlIChmb3IgT3BlcmEgMTIueCkKICAgICAgZWxzZSBpZiAoJ0NTU1N1cHBvcnRzUnVsZScgaW4gd2luZG93KSB7CiAgICAgICAgLy8gQnVpbGQgYSBjb25kaXRpb24gc3RyaW5nIGZvciBldmVyeSBwcmVmaXhlZCB2YXJpYW50CiAgICAgICAgdmFyIGNvbmRpdGlvblRleHQgPSBbXTsKICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICBjb25kaXRpb25UZXh0LnB1c2goJygnICsgZG9tVG9DU1MocHJvcHNbaV0pICsgJzonICsgdmFsdWUgKyAnKScpOwogICAgICAgIH0KICAgICAgICBjb25kaXRpb25UZXh0ID0gY29uZGl0aW9uVGV4dC5qb2luKCcgb3IgJyk7CiAgICAgICAgcmV0dXJuIGluamVjdEVsZW1lbnRXaXRoU3R5bGVzKCdAc3VwcG9ydHMgKCcgKyBjb25kaXRpb25UZXh0ICsgJykgeyAjbW9kZXJuaXpyIHsgcG9zaXRpb246IGFic29sdXRlOyB9IH0nLCBmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgcmV0dXJuIGNvbXB1dGVkU3R5bGUobm9kZSwgbnVsbCwgJ3Bvc2l0aW9uJykgPT09ICdhYnNvbHV0ZSc7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIDsKCiAgICAvKioKICAgICAqIGNzc1RvRE9NIHRha2VzIGEgaHlwaGVuLWNhc2Ugc3RyaW5nIGFuZCBjb252ZXJ0cyBpdCB0byBjYW1lbENhc2UKICAgICAqIGUuZy4gYm94LXNpemluZyAtPiBib3hTaXppbmcKICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBjc3NUb0RPTQogICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBTdHJpbmcgbmFtZSBvZiBoeXBoZW4tY2FzZSBwcm9wIHdlIHdhbnQgdG8gY29udmVydAogICAgICogQHJldHVybnMge3N0cmluZ30gVGhlIGNhbWVsQ2FzZSB2ZXJzaW9uIG9mIHRoZSBzdXBwbGllZCBuYW1lCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNzc1RvRE9NKG5hbWUpIHsKICAgICAgcmV0dXJuIG5hbWUucmVwbGFjZSgvKFthLXpdKS0oW2Etel0pL2csIGZ1bmN0aW9uIChzdHIsIG0xLCBtMikgewogICAgICAgIHJldHVybiBtMSArIG0yLnRvVXBwZXJDYXNlKCk7CiAgICAgIH0pLnJlcGxhY2UoL14tLywgJycpOwogICAgfQogICAgOwoKICAgIC8vIHRlc3RQcm9wcyBpcyBhIGdlbmVyaWMgQ1NTIC8gRE9NIHByb3BlcnR5IHRlc3QuCgogICAgLy8gSW4gdGVzdGluZyBzdXBwb3J0IGZvciBhIGdpdmVuIENTUyBwcm9wZXJ0eSwgaXQncyBsZWdpdCB0byB0ZXN0OgogICAgLy8gICAgYGVsZW0uc3R5bGVbc3R5bGVOYW1lXSAhPT0gdW5kZWZpbmVkYAogICAgLy8gSWYgdGhlIHByb3BlcnR5IGlzIHN1cHBvcnRlZCBpdCB3aWxsIHJldHVybiBhbiBlbXB0eSBzdHJpbmcsCiAgICAvLyBpZiB1bnN1cHBvcnRlZCBpdCB3aWxsIHJldHVybiB1bmRlZmluZWQuCgogICAgLy8gV2UnbGwgdGFrZSBhZHZhbnRhZ2Ugb2YgdGhpcyBxdWljayB0ZXN0IGFuZCBza2lwIHNldHRpbmcgYSBzdHlsZQogICAgLy8gb24gb3VyIG1vZGVybml6ciBlbGVtZW50LCBidXQgaW5zdGVhZCBqdXN0IHRlc3RpbmcgdW5kZWZpbmVkIHZzCiAgICAvLyBlbXB0eSBzdHJpbmcuCgogICAgLy8gUHJvcGVydHkgbmFtZXMgY2FuIGJlIHByb3ZpZGVkIGluIGVpdGhlciBjYW1lbENhc2Ugb3IgaHlwaGVuLWNhc2UuCgogICAgZnVuY3Rpb24gdGVzdFByb3BzKHByb3BzLCBwcmVmaXhlZCwgdmFsdWUsIHNraXBWYWx1ZVRlc3QpIHsKICAgICAgc2tpcFZhbHVlVGVzdCA9IGlzKHNraXBWYWx1ZVRlc3QsICd1bmRlZmluZWQnKSA/IGZhbHNlIDogc2tpcFZhbHVlVGVzdDsKCiAgICAgIC8vIFRyeSBuYXRpdmUgZGV0ZWN0IGZpcnN0CiAgICAgIGlmICghaXModmFsdWUsICd1bmRlZmluZWQnKSkgewogICAgICAgIHZhciByZXN1bHQgPSBuYXRpdmVUZXN0UHJvcHMocHJvcHMsIHZhbHVlKTsKICAgICAgICBpZiAoIWlzKHJlc3VsdCwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gT3RoZXJ3aXNlIGRvIGl0IHByb3Blcmx5CiAgICAgIHZhciBhZnRlckluaXQsIGksIHByb3BzTGVuZ3RoLCBwcm9wLCBiZWZvcmU7CgogICAgICAvLyBJZiB3ZSBkb24ndCBoYXZlIGEgc3R5bGUgZWxlbWVudCwgdGhhdCBtZWFucyB3ZSdyZSBydW5uaW5nIGFzeW5jIG9yIGFmdGVyCiAgICAgIC8vIHRoZSBjb3JlIHRlc3RzLCBzbyB3ZSdsbCBuZWVkIHRvIGNyZWF0ZSBvdXIgb3duIGVsZW1lbnRzIHRvIHVzZS4KCiAgICAgIC8vIEluc2lkZSBvZiBhbiBTVkcgZWxlbWVudCwgaW4gY2VydGFpbiBicm93c2VycywgdGhlIGBzdHlsZWAgZWxlbWVudCBpcyBvbmx5CiAgICAgIC8vIGRlZmluZWQgZm9yIHZhbGlkIHRhZ3MuIFRoZXJlZm9yZSwgaWYgYG1vZGVybml6cmAgZG9lcyBub3QgaGF2ZSBvbmUsIHdlCiAgICAgIC8vIGZhbGwgYmFjayB0byBhIGxlc3MgdXNlZCBlbGVtZW50IGFuZCBob3BlIGZvciB0aGUgYmVzdC4KICAgICAgLy8gRm9yIHN0cmljdCBYSFRNTCBicm93c2VycyB0aGUgaGFyZGx5IHVzZWQgc2FtcCBlbGVtZW50IGlzIHVzZWQuCiAgICAgIHZhciBlbGVtcyA9IFsnbW9kZXJuaXpyJywgJ3RzcGFuJywgJ3NhbXAnXTsKICAgICAgd2hpbGUgKCFtU3R5bGUuc3R5bGUgJiYgZWxlbXMubGVuZ3RoKSB7CiAgICAgICAgYWZ0ZXJJbml0ID0gdHJ1ZTsKICAgICAgICBtU3R5bGUubW9kRWxlbSA9IGNyZWF0ZUVsZW1lbnQoZWxlbXMuc2hpZnQoKSk7CiAgICAgICAgbVN0eWxlLnN0eWxlID0gbVN0eWxlLm1vZEVsZW0uc3R5bGU7CiAgICAgIH0KCiAgICAgIC8vIERlbGV0ZSB0aGUgb2JqZWN0cyBpZiB3ZSBjcmVhdGVkIHRoZW0uCiAgICAgIGZ1bmN0aW9uIGNsZWFuRWxlbXMoKSB7CiAgICAgICAgaWYgKGFmdGVySW5pdCkgewogICAgICAgICAgZGVsZXRlIG1TdHlsZS5zdHlsZTsKICAgICAgICAgIGRlbGV0ZSBtU3R5bGUubW9kRWxlbTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJvcHNMZW5ndGggPSBwcm9wcy5sZW5ndGg7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBwcm9wc0xlbmd0aDsgaSsrKSB7CiAgICAgICAgcHJvcCA9IHByb3BzW2ldOwogICAgICAgIGJlZm9yZSA9IG1TdHlsZS5zdHlsZVtwcm9wXTsKICAgICAgICBpZiAoY29udGFpbnMocHJvcCwgJy0nKSkgewogICAgICAgICAgcHJvcCA9IGNzc1RvRE9NKHByb3ApOwogICAgICAgIH0KICAgICAgICBpZiAobVN0eWxlLnN0eWxlW3Byb3BdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8vIElmIHZhbHVlIHRvIHRlc3QgaGFzIGJlZW4gcGFzc2VkIGluLCBkbyBhIHNldC1hbmQtY2hlY2sgdGVzdC4KICAgICAgICAgIC8vIDAgKGludGVnZXIpIGlzIGEgdmFsaWQgcHJvcGVydHkgdmFsdWUsIHNvIGNoZWNrIHRoYXQgYHZhbHVlYCBpc24ndAogICAgICAgICAgLy8gdW5kZWZpbmVkLCByYXRoZXIgdGhhbiBqdXN0IGNoZWNraW5nIGl0J3MgdHJ1dGh5LgogICAgICAgICAgaWYgKCFza2lwVmFsdWVUZXN0ICYmICFpcyh2YWx1ZSwgJ3VuZGVmaW5lZCcpKSB7CiAgICAgICAgICAgIC8vIE5lZWRzIGEgdHJ5IGNhdGNoIGJsb2NrIGJlY2F1c2Ugb2Ygb2xkIElFLiBUaGlzIGlzIHNsb3csIGJ1dCB3aWxsCiAgICAgICAgICAgIC8vIGJlIGF2b2lkZWQgaW4gbW9zdCBjYXNlcyBiZWNhdXNlIGBza2lwVmFsdWVUZXN0YCB3aWxsIGJlIHVzZWQuCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgbVN0eWxlLnN0eWxlW3Byb3BdID0gdmFsdWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CgogICAgICAgICAgICAvLyBJZiB0aGUgcHJvcGVydHkgdmFsdWUgaGFzIGNoYW5nZWQsIHdlIGFzc3VtZSB0aGUgdmFsdWUgdXNlZCBpcwogICAgICAgICAgICAvLyBzdXBwb3J0ZWQuIElmIGB2YWx1ZWAgaXMgZW1wdHkgc3RyaW5nLCBpdCdsbCBmYWlsIGhlcmUgKGJlY2F1c2UKICAgICAgICAgICAgLy8gaXQgaGFzbid0IGNoYW5nZWQpLCB3aGljaCBtYXRjaGVzIGhvdyBicm93c2VycyBoYXZlIGltcGxlbWVudGVkCiAgICAgICAgICAgIC8vIENTUy5zdXBwb3J0cygpCiAgICAgICAgICAgIGlmIChtU3R5bGUuc3R5bGVbcHJvcF0gIT09IGJlZm9yZSkgewogICAgICAgICAgICAgIGNsZWFuRWxlbXMoKTsKICAgICAgICAgICAgICByZXR1cm4gcHJlZml4ZWQgPT09ICdwZngnID8gcHJvcCA6IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8vIE90aGVyd2lzZSBqdXN0IHJldHVybiB0cnVlLCBvciB0aGUgcHJvcGVydHkgbmFtZSBpZiB0aGlzIGlzIGEKICAgICAgICAgIC8vIGBwcmVmaXhlZCgpYCBjYWxsCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY2xlYW5FbGVtcygpOwogICAgICAgICAgICByZXR1cm4gcHJlZml4ZWQgPT09ICdwZngnID8gcHJvcCA6IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNsZWFuRWxlbXMoKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgOwoKICAgIC8qKgogICAgICogTGlzdCBvZiBKYXZhU2NyaXB0IERPTSB2YWx1ZXMgdXNlZCBmb3IgdGVzdHMKICAgICAqCiAgICAgKiBAbWVtYmVyT2YgTW9kZXJuaXpyCiAgICAgKiBAbmFtZSBNb2Rlcm5penIuX2RvbVByZWZpeGVzCiAgICAgKiBAb3B0aW9uTmFtZSBNb2Rlcm5penIuX2RvbVByZWZpeGVzCiAgICAgKiBAb3B0aW9uUHJvcCBkb21QcmVmaXhlcwogICAgICogQGFjY2VzcyBwdWJsaWMKICAgICAqIEBleGFtcGxlCiAgICAgKgogICAgICogTW9kZXJuaXpyLl9kb21QcmVmaXhlcyBpcyBleGFjdGx5IHRoZSBzYW1lIGFzIFtfcHJlZml4ZXNdKCNtb2Rlcm5penItX3ByZWZpeGVzKSwgYnV0IHJhdGhlcgogICAgICogdGhhbiBoeXBoZW4tY2FzZSBwcm9wZXJ0aWVzLCBhbGwgcHJvcGVydGllcyBhcmUgdGhlaXIgQ2FwaXRhbGl6ZWQgdmFyaWFudAogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBNb2Rlcm5penIuX2RvbVByZWZpeGVzID09PSBbICJNb3oiLCAiTyIsICJtcyIsICJXZWJraXQiIF07CiAgICAgKiBgYGAKICAgICAqLwogICAgdmFyIGRvbVByZWZpeGVzID0gTW9kZXJuaXpyUHJvdG8uX2NvbmZpZy51c2VQcmVmaXhlcyA/IG9tUHJlZml4ZXMudG9Mb3dlckNhc2UoKS5zcGxpdCgnICcpIDogW107CiAgICBNb2Rlcm5penJQcm90by5fZG9tUHJlZml4ZXMgPSBkb21QcmVmaXhlczsKCiAgICAvKioKICAgICAqIGZuQmluZCBpcyBhIHN1cGVyIHNtYWxsIFtiaW5kXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9GdW5jdGlvbi9iaW5kKSBwb2x5ZmlsbC4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiBmbkJpbmQKICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIC0gYSBmdW5jdGlvbiB5b3Ugd2FudCB0byBjaGFuZ2UgYHRoaXNgIHJlZmVyZW5jZSB0bwogICAgICogQHBhcmFtIHtvYmplY3R9IHRoYXQgLSB0aGUgYHRoaXNgIHlvdSB3YW50IHRvIGNhbGwgdGhlIGZ1bmN0aW9uIHdpdGgKICAgICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gVGhlIHdyYXBwZWQgdmVyc2lvbiBvZiB0aGUgc3VwcGxpZWQgZnVuY3Rpb24KICAgICAqLwogICAgZnVuY3Rpb24gZm5CaW5kKGZuLCB0aGF0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiB0ZXN0RE9NUHJvcHMgaXMgYSBnZW5lcmljIERPTSBwcm9wZXJ0eSB0ZXN0OyBpZiBhIGJyb3dzZXIgc3VwcG9ydHMKICAgICAqICAgYSBjZXJ0YWluIHByb3BlcnR5LCBpdCB3b24ndCByZXR1cm4gdW5kZWZpbmVkIGZvciBpdC4KICAgICAqCiAgICAgKiBAYWNjZXNzIHByaXZhdGUKICAgICAqIEBmdW5jdGlvbiB0ZXN0RE9NUHJvcHMKICAgICAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gcHJvcHMgLSBBbiBhcnJheSBvZiBwcm9wZXJ0aWVzIHRvIHRlc3QgZm9yCiAgICAgKiBAcGFyYW0ge29iamVjdH0gb2JqIC0gQW4gb2JqZWN0IG9yIEVsZW1lbnQgeW91IHdhbnQgdG8gdXNlIHRvIHRlc3QgdGhlIHBhcmFtZXRlcnMgYWdhaW4KICAgICAqIEBwYXJhbSB7Ym9vbGVhbnxvYmplY3R9IGVsZW0gLSBBbiBFbGVtZW50IHRvIGJpbmQgdGhlIHByb3BlcnR5IGxvb2t1cCBhZ2Fpbi4gVXNlIGBmYWxzZWAgdG8gcHJldmVudCB0aGUgY2hlY2sKICAgICAqIEByZXR1cm5zIHtib29sZWFufCp9IHJldHVybnMgYGZhbHNlYCBpZiB0aGUgcHJvcCBpcyB1bnN1cHBvcnRlZCwgb3RoZXJ3aXNlIHRoZSB2YWx1ZSB0aGF0IGlzIHN1cHBvcnRlZAogICAgICovCiAgICBmdW5jdGlvbiB0ZXN0RE9NUHJvcHMocHJvcHMsIG9iaiwgZWxlbSkgewogICAgICB2YXIgaXRlbTsKICAgICAgZm9yICh2YXIgaSBpbiBwcm9wcykgewogICAgICAgIGlmIChwcm9wc1tpXSBpbiBvYmopIHsKICAgICAgICAgIC8vIHJldHVybiB0aGUgcHJvcGVydHkgbmFtZSBhcyBhIHN0cmluZwogICAgICAgICAgaWYgKGVsZW0gPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBwcm9wc1tpXTsKICAgICAgICAgIH0KICAgICAgICAgIGl0ZW0gPSBvYmpbcHJvcHNbaV1dOwoKICAgICAgICAgIC8vIGxldCdzIGJpbmQgYSBmdW5jdGlvbgogICAgICAgICAgaWYgKGlzKGl0ZW0sICdmdW5jdGlvbicpKSB7CiAgICAgICAgICAgIC8vIGJpbmQgdG8gb2JqIHVubGVzcyBvdmVycmlkZGVuCiAgICAgICAgICAgIHJldHVybiBmbkJpbmQoaXRlbSwgZWxlbSB8fCBvYmopOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHJldHVybiB0aGUgdW5ib3VuZCBmdW5jdGlvbiBvciBvYmogb3IgdmFsdWUKICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICA7CgogICAgLyoqCiAgICAgKiB0ZXN0UHJvcHNBbGwgdGVzdHMgYSBsaXN0IG9mIERPTSBwcm9wZXJ0aWVzIHdlIHdhbnQgdG8gY2hlY2sgYWdhaW5zdC4KICAgICAqIFdlIHNwZWNpZnkgbGl0ZXJhbGx5IEFMTCBwb3NzaWJsZSAoa25vd24gYW5kL29yIGxpa2VseSkgcHJvcGVydGllcyBvbgogICAgICogdGhlIGVsZW1lbnQgaW5jbHVkaW5nIHRoZSBub24tdmVuZG9yIHByZWZpeGVkIG9uZSwgZm9yIGZvcndhcmQtCiAgICAgKiBjb21wYXRpYmlsaXR5LgogICAgICoKICAgICAqIEBhY2Nlc3MgcHJpdmF0ZQogICAgICogQGZ1bmN0aW9uIHRlc3RQcm9wc0FsbAogICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3AgLSBBIHN0cmluZyBvZiB0aGUgcHJvcGVydHkgdG8gdGVzdCBmb3IKICAgICAqIEBwYXJhbSB7c3RyaW5nfG9iamVjdH0gW3ByZWZpeGVkXSAtIEFuIG9iamVjdCB0byBjaGVjayB0aGUgcHJlZml4ZWQgcHJvcGVydGllcyBvbi4gVXNlIGEgc3RyaW5nIHRvIHNraXAKICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8U1ZHRWxlbWVudH0gW2VsZW1dIC0gQW4gZWxlbWVudCB1c2VkIHRvIHRlc3QgdGhlIHByb3BlcnR5IGFuZCB2YWx1ZSBhZ2FpbnN0CiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW3ZhbHVlXSAtIEEgc3RyaW5nIG9mIGEgY3NzIHZhbHVlCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtza2lwVmFsdWVUZXN0XSAtIEFuIGJvb2xlYW4gcmVwcmVzZW50aW5nIGlmIHlvdSB3YW50IHRvIHRlc3QgaWYgdmFsdWUgc3RpY2tzIHdoZW4gc2V0CiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfGJvb2xlYW59IHJldHVybnMgdGhlIHN0cmluZyB2ZXJzaW9uIG9mIHRoZSBwcm9wZXJ0eSwgb3IgYGZhbHNlYCBpZiBpdCBpcyB1bnN1cHBvcnRlZAogICAgICovCiAgICBmdW5jdGlvbiB0ZXN0UHJvcHNBbGwocHJvcCwgcHJlZml4ZWQsIGVsZW0sIHZhbHVlLCBza2lwVmFsdWVUZXN0KSB7CiAgICAgIHZhciB1Y1Byb3AgPSBwcm9wLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcHJvcC5zbGljZSgxKSwKICAgICAgICBwcm9wcyA9IChwcm9wICsgJyAnICsgY3Nzb21QcmVmaXhlcy5qb2luKHVjUHJvcCArICcgJykgKyB1Y1Byb3ApLnNwbGl0KCcgJyk7CgogICAgICAvLyBkaWQgdGhleSBjYWxsIC5wcmVmaXhlZCgnYm94U2l6aW5nJykgb3IgYXJlIHdlIGp1c3QgdGVzdGluZyBhIHByb3A/CiAgICAgIGlmIChpcyhwcmVmaXhlZCwgJ3N0cmluZycpIHx8IGlzKHByZWZpeGVkLCAndW5kZWZpbmVkJykpIHsKICAgICAgICByZXR1cm4gdGVzdFByb3BzKHByb3BzLCBwcmVmaXhlZCwgdmFsdWUsIHNraXBWYWx1ZVRlc3QpOwoKICAgICAgICAvLyBvdGhlcndpc2UsIHRoZXkgY2FsbGVkIC5wcmVmaXhlZCgncmVxdWVzdEFuaW1hdGlvbkZyYW1lJywgd2luZG93WywgZWxlbV0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvcHMgPSAocHJvcCArICcgJyArIGRvbVByZWZpeGVzLmpvaW4odWNQcm9wICsgJyAnKSArIHVjUHJvcCkuc3BsaXQoJyAnKTsKICAgICAgICByZXR1cm4gdGVzdERPTVByb3BzKHByb3BzLCBwcmVmaXhlZCwgZWxlbSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBNb2Rlcm5penIudGVzdEFsbFByb3BzKCkgaW52ZXN0aWdhdGVzIHdoZXRoZXIgYSBnaXZlbiBzdHlsZSBwcm9wZXJ0eSwKICAgIC8vIG9yIGFueSBvZiBpdHMgdmVuZG9yLXByZWZpeGVkIHZhcmlhbnRzLCBpcyByZWNvZ25pemVkCiAgICAvLwogICAgLy8gTm90ZSB0aGF0IHRoZSBwcm9wZXJ0eSBuYW1lcyBtdXN0IGJlIHByb3ZpZGVkIGluIHRoZSBjYW1lbENhc2UgdmFyaWFudC4KICAgIC8vIE1vZGVybml6ci50ZXN0QWxsUHJvcHMoJ2JveFNpemluZycpCiAgICBNb2Rlcm5penJQcm90by50ZXN0QWxsUHJvcHMgPSB0ZXN0UHJvcHNBbGw7CgogICAgLyoqCiAgICAgKiB0ZXN0QWxsUHJvcHMgZGV0ZXJtaW5lcyB3aGV0aGVyIGEgZ2l2ZW4gQ1NTIHByb3BlcnR5IGlzIHN1cHBvcnRlZCBpbiB0aGUgYnJvd3NlcgogICAgICoKICAgICAqIEBtZW1iZXJPZiBNb2Rlcm5penIKICAgICAqIEBuYW1lIE1vZGVybml6ci50ZXN0QWxsUHJvcHMKICAgICAqIEBvcHRpb25OYW1lIE1vZGVybml6ci50ZXN0QWxsUHJvcHMoKQogICAgICogQG9wdGlvblByb3AgdGVzdEFsbFByb3BzCiAgICAgKiBAYWNjZXNzIHB1YmxpYwogICAgICogQGZ1bmN0aW9uIHRlc3RBbGxQcm9wcwogICAgICogQHBhcmFtIHtzdHJpbmd9IHByb3AgLSBTdHJpbmcgbmFtaW5nIHRoZSBwcm9wZXJ0eSB0byB0ZXN0IChlaXRoZXIgY2FtZWxDYXNlIG9yIGh5cGhlbi1jYXNlKQogICAgICogQHBhcmFtIHtzdHJpbmd9IFt2YWx1ZV0gLSBTdHJpbmcgb2YgdGhlIHZhbHVlIHRvIHRlc3QKICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW3NraXBWYWx1ZVRlc3Q9ZmFsc2VdIC0gV2hldGhlciB0byBza2lwIHRlc3RpbmcgdGhhdCB0aGUgdmFsdWUgaXMgc3VwcG9ydGVkIHdoZW4gdXNpbmcgbm9uLW5hdGl2ZSBkZXRlY3Rpb24KICAgICAqIEByZXR1cm5zIHtzdHJpbmd8Ym9vbGVhbn0gcmV0dXJucyB0aGUgc3RyaW5nIHZlcnNpb24gb2YgdGhlIHByb3BlcnR5LCBvciBgZmFsc2VgIGlmIGl0IGlzIHVuc3VwcG9ydGVkCiAgICAgKiBAZXhhbXBsZQogICAgICoKICAgICAqIHRlc3RBbGxQcm9wcyBkZXRlcm1pbmVzIHdoZXRoZXIgYSBnaXZlbiBDU1MgcHJvcGVydHksIGluIHNvbWUgcHJlZml4ZWQgZm9ybSwKICAgICAqIGlzIHN1cHBvcnRlZCBieSB0aGUgYnJvd3Nlci4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogdGVzdEFsbFByb3BzKCdib3hTaXppbmcnKSAgLy8gdHJ1ZQogICAgICogYGBgCiAgICAgKgogICAgICogSXQgY2FuIG9wdGlvbmFsbHkgYmUgZ2l2ZW4gYSBDU1MgdmFsdWUgaW4gc3RyaW5nIGZvcm0gdG8gdGVzdCBpZiBhIHByb3BlcnR5CiAgICAgKiB2YWx1ZSBpcyB2YWxpZAogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiB0ZXN0QWxsUHJvcHMoJ2Rpc3BsYXknLCAnYmxvY2snKSAvLyB0cnVlCiAgICAgKiB0ZXN0QWxsUHJvcHMoJ2Rpc3BsYXknLCAncGVuZ3VpbicpIC8vIGZhbHNlCiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBBIGJvb2xlYW4gY2FuIGJlIHBhc3NlZCBhcyBhIHRoaXJkIHBhcmFtZXRlciB0byBza2lwIHRoZSB2YWx1ZSBjaGVjayB3aGVuCiAgICAgKiBuYXRpdmUgZGV0ZWN0aW9uIChAc3VwcG9ydHMpIGlzbid0IGF2YWlsYWJsZS4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogdGVzdEFsbFByb3BzKCdzaGFwZU91dHNpZGUnLCAnY29udGVudC1ib3gnLCB0cnVlKTsKICAgICAqIGBgYAogICAgICovCiAgICBmdW5jdGlvbiB0ZXN0QWxsUHJvcHMocHJvcCwgdmFsdWUsIHNraXBWYWx1ZVRlc3QpIHsKICAgICAgcmV0dXJuIHRlc3RQcm9wc0FsbChwcm9wLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdmFsdWUsIHNraXBWYWx1ZVRlc3QpOwogICAgfQogICAgTW9kZXJuaXpyUHJvdG8udGVzdEFsbFByb3BzID0gdGVzdEFsbFByb3BzOwoKICAgIC8qIQogICAgewogICAgICAibmFtZSI6ICJCYWNrZHJvcCBGaWx0ZXIiLAogICAgICAicHJvcGVydHkiOiAiYmFja2Ryb3BmaWx0ZXIiLAogICAgICAiYXV0aG9ycyI6IFsiQnJpYW4gU2V3YXJkIl0sCiAgICAgICJ0YWdzIjogWyJjc3MiXSwKICAgICAgImNhbml1c2UiOiAiY3NzLWJhY2tkcm9wLWZpbHRlciIsCiAgICAgICJub3RlcyI6IFt7CiAgICAgICAgIm5hbWUiOiAiVzNDIEVkaXRvcuKAmXMgRHJhZnQgU3BlYyIsCiAgICAgICAgImhyZWYiOiAiaHR0cHM6Ly9kcmFmdHMuZnh0Zi5vcmcvZmlsdGVycy0yLyNCYWNrZHJvcEZpbHRlclByb3BlcnR5IgogICAgICB9LCB7CiAgICAgICAgIm5hbWUiOiAiV2ViS2l0IEJsb2cgaW50cm9kdWN0aW9uICsgRGVtbyIsCiAgICAgICAgImhyZWYiOiAiaHR0cHM6Ly93d3cud2Via2l0Lm9yZy9ibG9nLzM2MzIvaW50cm9kdWNpbmctYmFja2Ryb3AtZmlsdGVycy8iCiAgICAgIH1dCiAgICB9CiAgICAhKi8KICAgIC8qIERPQwogICAgRGV0ZWN0cyBzdXBwb3J0IGZvciBDU1MgQmFja2Ryb3AgRmlsdGVycywgYWxsb3dpbmcgZm9yIGJhY2tncm91bmQgYmx1ciBlZmZlY3RzIGxpa2UgdGhvc2UgaW50cm9kdWNlZCBpbiBpT1MgNy4gU3VwcG9ydCBmb3IgdGhpcyB3YXMgYWRkZWQgdG8gaU9TIFNhZmFyaS9XZWJLaXQgaW4gaU9TIDkuCiAgICAqLwoKICAgIE1vZGVybml6ci5hZGRUZXN0KCdiYWNrZHJvcGZpbHRlcicsIHRlc3RBbGxQcm9wcygnYmFja2Ryb3BGaWx0ZXInKSk7CgogICAgLy8gUnVuIGVhY2ggdGVzdAogICAgdGVzdFJ1bm5lcigpOwoKICAgIC8vIFJlbW92ZSB0aGUgIm5vLWpzIiBjbGFzcyBpZiBpdCBleGlzdHMKICAgIHNldENsYXNzZXMoY2xhc3Nlcyk7CiAgICBkZWxldGUgTW9kZXJuaXpyUHJvdG8uYWRkVGVzdDsKICAgIGRlbGV0ZSBNb2Rlcm5penJQcm90by5hZGRBc3luY1Rlc3Q7CgogICAgLy8gUnVuIHRoZSB0aGluZ3MgdGhhdCBhcmUgc3VwcG9zZWQgdG8gcnVuIGFmdGVyIHRoZSB0ZXN0cwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBNb2Rlcm5penIuX3EubGVuZ3RoOyBpKyspIHsKICAgICAgTW9kZXJuaXpyLl9xW2ldKCk7CiAgICB9CgogICAgLy8gTGVhayBNb2Rlcm5penIgbmFtZXNwYWNlCiAgICBzY3JpcHRHbG9iYWxPYmplY3QuTW9kZXJuaXpyID0gTW9kZXJuaXpyOwogICAgOwogIH0pKHdpbmRvdywgd2luZG93LCBkb2N1bWVudCk7CiAgbW9kdWxlLmV4cG9ydHMgPSB3aW5kb3cuTW9kZXJuaXpyOwogIGlmIChoYWRHbG9iYWwpIHsKICAgIHdpbmRvdy5Nb2Rlcm5penIgPSBvbGRHbG9iYWw7CiAgfSBlbHNlIHsKICAgIGRlbGV0ZSB3aW5kb3cuTW9kZXJuaXpyOwogIH0KfSkod2luZG93KTs="},null]}